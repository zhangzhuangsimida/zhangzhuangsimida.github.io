<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="技术日记和杂七杂八的dx">
<meta property="og:type" content="website">
<meta property="og:title" content="地球上的小东西">
<meta property="og:url" content="http://example.com/page/2/index.html">
<meta property="og:site_name" content="地球上的小东西">
<meta property="og:description" content="技术日记和杂七杂八的dx">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="oldnineping">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>地球上的小东西</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">地球上的小东西</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">hiahiahiahia</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-heartbeat fa-fw"></i>公益 404</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/25/Kotlin%E6%96%B9%E6%B3%95%E4%B8%8ELambda%E8%A1%A8%E8%BE%BE%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="oldnineping">
      <meta itemprop="description" content="技术日记和杂七杂八的dx">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="地球上的小东西">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/25/Kotlin%E6%96%B9%E6%B3%95%E4%B8%8ELambda%E8%A1%A8%E8%BE%BE%E5%BC%8F/" class="post-title-link" itemprop="url">Kotlin方法与Lambda表达式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-25 18:41:00" itemprop="dateCreated datePublished" datetime="2021-04-25T18:41:00+08:00">2021-04-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-25 17:27:32" itemprop="dateModified" datetime="2021-06-25T17:27:32+08:00">2021-06-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kotlin/" itemprop="url" rel="index"><span itemprop="name">Kotlin</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Kotlin方法与Lambda表达式"><a href="#Kotlin方法与Lambda表达式" class="headerlink" title="Kotlin方法与Lambda表达式"></a>Kotlin方法与Lambda表达式</h1>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/04/25/Kotlin%E6%96%B9%E6%B3%95%E4%B8%8ELambda%E8%A1%A8%E8%BE%BE%E5%BC%8F/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/12/adb%E7%9B%B8%E5%85%B3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="oldnineping">
      <meta itemprop="description" content="技术日记和杂七杂八的dx">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="地球上的小东西">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/12/adb%E7%9B%B8%E5%85%B3/" class="post-title-link" itemprop="url">adb相关</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-12 19:17:49" itemprop="dateCreated datePublished" datetime="2021-04-12T19:17:49+08:00">2021-04-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-30 08:35:31" itemprop="dateModified" datetime="2021-04-30T08:35:31+08:00">2021-04-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/adb/" itemprop="url" rel="index"><span itemprop="name">adb</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="adb相关问题"><a href="#adb相关问题" class="headerlink" title="adb相关问题"></a>adb相关问题</h1>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/04/12/adb%E7%9B%B8%E5%85%B3/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/07/Zygote%E7%9A%84%E4%BD%9C%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="oldnineping">
      <meta itemprop="description" content="技术日记和杂七杂八的dx">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="地球上的小东西">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/07/Zygote%E7%9A%84%E4%BD%9C%E7%94%A8/" class="post-title-link" itemprop="url">Zygote的作用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-07 13:47:03" itemprop="dateCreated datePublished" datetime="2021-04-07T13:47:03+08:00">2021-04-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-30 08:35:31" itemprop="dateModified" datetime="2021-04-30T08:35:31+08:00">2021-04-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Framework/" itemprop="url" rel="index"><span itemprop="name">Framework</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <a id="more"></a>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/06/%E6%8E%92%E5%BA%8F%EF%BC%88%E4%B8%8B%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="oldnineping">
      <meta itemprop="description" content="技术日记和杂七杂八的dx">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="地球上的小东西">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/06/%E6%8E%92%E5%BA%8F%EF%BC%88%E4%B8%8B%EF%BC%89/" class="post-title-link" itemprop="url">排序（下）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-06 15:48:43" itemprop="dateCreated datePublished" datetime="2021-04-06T15:48:43+08:00">2021-04-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-25 17:27:32" itemprop="dateModified" datetime="2021-06-25T17:27:32+08:00">2021-06-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">数据结构与算法</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E6%8E%92%E5%BA%8F/" itemprop="url" rel="index"><span itemprop="name">排序</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="排序（下）归并-快速，用快排思想在O-n-内查找第K大元素"><a href="#排序（下）归并-快速，用快排思想在O-n-内查找第K大元素" class="headerlink" title="排序（下）归并 快速，用快排思想在O(n)内查找第K大元素"></a>排序（下）归并 快速，用快排思想在O(n)内查找第K大元素</h1>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/04/06/%E6%8E%92%E5%BA%8F%EF%BC%88%E4%B8%8B%EF%BC%89/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/04/01/Kotlin%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="oldnineping">
      <meta itemprop="description" content="技术日记和杂七杂八的dx">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="地球上的小东西">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/04/01/Kotlin%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">Kotlin基础</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-04-01 15:39:15" itemprop="dateCreated datePublished" datetime="2021-04-01T15:39:15+08:00">2021-04-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-04-30 08:35:31" itemprop="dateModified" datetime="2021-04-30T08:35:31+08:00">2021-04-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Kotlin/" itemprop="url" rel="index"><span itemprop="name">Kotlin</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Kotlin-基础"><a href="#Kotlin-基础" class="headerlink" title="Kotlin 基础"></a>Kotlin 基础</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>​    Kotlin是一种在Java虚拟机上运行的静态类型编程语言。它主要是JetBrains开发团队所开发出来的编程语言。<br>虽然Kotlin与Java语法并不兼容，但Kotlin被设计成可以和Java代码相互运作，并可以重复使用如Java集合框架等现有Java引用的方法库。它很容易在Android项目中替代Java或者同Java一起使用。</p>
<h3 id="Kotlin的特点："><a href="#Kotlin的特点：" class="headerlink" title="Kotlin的特点："></a>Kotlin的特点：</h3><ul>
<li>简洁易用: Kotlin中提供了大量的扩展，使得我们的代码更加简洁，开发出来的框架更加易用</li>
<li>安全: 避免空指针异常等整个类的错误</li>
<li>互操作性: 充分利用 JVM、Android 和浏览器的现有库</li>
<li>工具友好: 可用任何 Java IDE 或者使用命令行构建</li>
</ul>
<h3 id="Kotlin-构建流程："><a href="#Kotlin-构建流程：" class="headerlink" title="Kotlin 构建流程："></a>Kotlin 构建流程：</h3><p><img src="/2021/04/01/Kotlin%E5%9F%BA%E7%A1%80/image-20210401154811917.png" alt="image-20210401154811917"></p>
<ul>
<li>*kt 会被Kotlin编译器变成编译为.class 的字节码文件，然后被归档成.jar ，最后由各平台打包工具输出最终的程序</li>
<li>我们用Java写的程序所有的实现都会有标准的Java类库来做支撑，比如：<code>java.lang.*</code>,<code>java.util.*</code>但是Kot lin中的类库是不在标准的Java类库中的，所以，Kotlin应用程序需要在最后一步借助Kotlin运行时来支撑这些Java标准库没有的实现。</li>
</ul>
<h2 id="Kotlin和Java的异同"><a href="#Kotlin和Java的异同" class="headerlink" title="Kotlin和Java的异同"></a>Kotlin和Java的异同</h2><h3 id="打印日志"><a href="#打印日志" class="headerlink" title="打印日志"></a>打印日志</h3><p>Java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">System.out.print(<span class="string">&quot;hello world&quot;</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;hello world&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>Kotlin:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">&quot;hello world&quot;</span>)</span><br><span class="line">println(<span class="string">&quot;hello world&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="定义变量与常量"><a href="#定义变量与常量" class="headerlink" title="定义变量与常量"></a>定义变量与常量</h3><p>Java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String name = <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line"><span class="keyword">final</span> String name = <span class="string">&quot;hello world&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>Kotlin:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> name = <span class="string">&quot;hello world&quot;</span></span><br><span class="line"><span class="keyword">val</span> name = <span class="string">&quot;hello world&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="null声明"><a href="#null声明" class="headerlink" title="null声明"></a>null声明</h3><p>Java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String otherName;</span><br><span class="line">otherName = <span class="keyword">null</span>;</span><br></pre></td></tr></table></figure>
<p>Kotlin:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> otherName : String?</span><br><span class="line">otherName = <span class="literal">null</span></span><br></pre></td></tr></table></figure>
<h3 id="空判断"><a href="#空判断" class="headerlink" title="空判断"></a>空判断</h3><p>Java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (text != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">int</span> length = text.length();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Kotlin:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">text?.let &#123;<span class="comment">//表示text不为null的条件下，才会去执行let函数体</span></span><br><span class="line">    <span class="keyword">val</span> length = text.length</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// or simply</span></span><br><span class="line"><span class="keyword">val</span> length = text?.length</span><br></pre></td></tr></table></figure>
<h3 id="字符串拼接"><a href="#字符串拼接" class="headerlink" title="字符串拼接"></a>字符串拼接</h3><p>Java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String firstName = <span class="string">&quot;Android&quot;</span>;</span><br><span class="line">String lastName = <span class="string">&quot;Architect&quot;</span>;</span><br><span class="line">String message = <span class="string">&quot;My name is: &quot;</span> + firstName + <span class="string">&quot; &quot;</span> + lastName;</span><br></pre></td></tr></table></figure>
<p>Kotlin:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> firstName = <span class="string">&quot;Android&quot;</span></span><br><span class="line"><span class="keyword">val</span> lastName = <span class="string">&quot;Architect&quot;</span></span><br><span class="line"><span class="keyword">val</span> message = <span class="string">&quot;My name is: <span class="variable">$firstName</span> <span class="variable">$lastName</span>&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="换行"><a href="#换行" class="headerlink" title="换行"></a>换行</h3><p>Java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String text = <span class="string">&quot;First Line\n&quot;</span> +</span><br><span class="line">              <span class="string">&quot;Second Line\n&quot;</span> +</span><br><span class="line">              <span class="string">&quot;Third Line&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>Kotlin:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> text = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        |First Line</span></span><br><span class="line"><span class="string">        |Second Line</span></span><br><span class="line"><span class="string">        |Third Line</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span>.trimMargin()</span><br></pre></td></tr></table></figure>
<h3 id="三元表达式"><a href="#三元表达式" class="headerlink" title="三元表达式"></a>三元表达式</h3><p>Java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String text = x &gt; <span class="number">5</span> ? <span class="string">&quot;x &gt; 5&quot;</span> : <span class="string">&quot;x &lt;= 5&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>Kotlin:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> text = <span class="keyword">if</span> (x &gt; <span class="number">5</span>)</span><br><span class="line">              <span class="string">&quot;x &gt; 5&quot;</span></span><br><span class="line">           <span class="keyword">else</span> <span class="string">&quot;x &lt;= 5&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="操作符"><a href="#操作符" class="headerlink" title="操作符"></a>操作符</h3><p>Java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> andResult  = a &amp; b;</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> orResult   = a | b;</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> xorResult  = a ^ b;</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> rightShift = a &gt;&gt; <span class="number">2</span>;</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> leftShift  = a &lt;&lt; <span class="number">2</span>;</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">int</span> unsignedRightShift = a &gt;&gt;&gt; <span class="number">2</span>;</span><br></pre></td></tr></table></figure>
<p>Kotlin:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> andResult  = a and b</span><br><span class="line"><span class="keyword">val</span> orResult   = a or b</span><br><span class="line"><span class="keyword">val</span> xorResult  = a xor b</span><br><span class="line"><span class="keyword">val</span> rightShift = a shr <span class="number">2</span></span><br><span class="line"><span class="keyword">val</span> leftShift  = a shl <span class="number">2</span></span><br><span class="line"><span class="keyword">val</span> unsignedRightShift = a ushr <span class="number">2</span></span><br></pre></td></tr></table></figure>
<h3 id="类型判断和转换（声明式）"><a href="#类型判断和转换（声明式）" class="headerlink" title="类型判断和转换（声明式）"></a>类型判断和转换（声明式）</h3><p>Java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (object <span class="keyword">instanceof</span> Car) &#123;</span><br><span class="line">   Car car = (Car) object;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Kotlin:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">object</span> <span class="keyword">is</span> Car) &#123;</span><br><span class="line">   <span class="keyword">var</span> car = <span class="keyword">object</span> <span class="comment">// 自动识别</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="类型判断和转换（隐式）"><a href="#类型判断和转换（隐式）" class="headerlink" title="类型判断和转换（隐式）"></a>类型判断和转换（隐式）</h3><p>Java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (object <span class="keyword">instanceof</span> Car) &#123;</span><br><span class="line">   Car car = (Car) object;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Kotlin:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">object</span> <span class="keyword">is</span> Car) &#123;</span><br><span class="line">   <span class="keyword">var</span> car = <span class="keyword">object</span> <span class="comment">// 自动识别</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="多重条件"><a href="#多重条件" class="headerlink" title="多重条件"></a>多重条件</h3><p>Java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (score &gt;= <span class="number">0</span> &amp;&amp; score &lt;= <span class="number">300</span>) &#123; &#125;</span><br></pre></td></tr></table></figure>
<p>Kotlin:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (score <span class="keyword">in</span> <span class="number">0.</span><span class="number">.300</span>) &#123; &#125;</span><br></pre></td></tr></table></figure>
<h3 id="更灵活的case语句"><a href="#更灵活的case语句" class="headerlink" title="更灵活的case语句"></a>更灵活的case语句</h3><p>Java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> score = <span class="comment">// some score;</span></span><br><span class="line">String grade;</span><br><span class="line"><span class="keyword">switch</span> (score) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">10</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">9</span>:</span><br><span class="line">        grade = <span class="string">&quot;Excellent&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">        grade = <span class="string">&quot;Good&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        grade = <span class="string">&quot;OK&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        grade = <span class="string">&quot;Fail&quot;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        grade = <span class="string">&quot;Fail&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Kotlin:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> score = <span class="comment">// some score</span></span><br><span class="line"><span class="keyword">var</span> grade = <span class="keyword">when</span> (score) &#123;</span><br><span class="line">    <span class="number">9</span>, <span class="number">10</span> -&gt; <span class="string">&quot;Excellent&quot;</span></span><br><span class="line">    <span class="keyword">in</span> <span class="number">6.</span><span class="number">.8</span> -&gt; <span class="string">&quot;Good&quot;</span></span><br><span class="line">    <span class="number">4</span>, <span class="number">5</span> -&gt; <span class="string">&quot;OK&quot;</span></span><br><span class="line">    <span class="keyword">in</span> <span class="number">1.</span><span class="number">.3</span> -&gt; <span class="string">&quot;Fail&quot;</span></span><br><span class="line">    <span class="keyword">else</span> -&gt; <span class="string">&quot;Fail&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="for-循环"><a href="#for-循环" class="headerlink" title="for 循环"></a>for 循环</h3><p>Java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span> ; i++) &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; <span class="number">10</span> ; i++) &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">10</span>; i &gt;= <span class="number">0</span> ; i--) &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span> ; i+=<span class="number">2</span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">10</span>; i &gt;= <span class="number">0</span> ; i-=<span class="number">2</span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (String item : collection) &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry: map.entrySet()) &#123; &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Kotlin:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1.</span><span class="number">.10</span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span> until <span class="number">10</span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">10</span> downTo <span class="number">0</span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1.</span><span class="number">.10</span> step <span class="number">2</span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">10</span> downTo <span class="number">0</span> step <span class="number">2</span>) &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (item <span class="keyword">in</span> collection) &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ((key, value) <span class="keyword">in</span> map) &#123; &#125;</span><br></pre></td></tr></table></figure>
<h3 id="更方便的集合"><a href="#更方便的集合" class="headerlink" title="更方便的集合"></a>更方便的集合</h3><p>Java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> List&lt;Integer&gt; listOfNumber = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> Map&lt;Integer, String&gt; keyValue = <span class="keyword">new</span> HashMap&lt;Integer, String&gt;();</span><br><span class="line">map.put(<span class="number">1</span>, <span class="string">&quot;Android&quot;</span>);</span><br><span class="line">map.put(<span class="number">2</span>, <span class="string">&quot;Ali&quot;</span>);</span><br><span class="line">map.put(<span class="number">3</span>, <span class="string">&quot;Mindorks&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Java 9</span></span><br><span class="line"><span class="keyword">final</span> List&lt;Integer&gt; listOfNumber = List.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> Map&lt;Integer, String&gt; keyValue = Map.of(<span class="number">1</span>, <span class="string">&quot;Android&quot;</span>,</span><br><span class="line">                                             <span class="number">2</span>, <span class="string">&quot;Ali&quot;</span>,</span><br><span class="line">                                             <span class="number">3</span>, <span class="string">&quot;Mindorks&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>Kotlin:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> listOfNumber = listOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="keyword">val</span> keyValue = mapOf(<span class="number">1</span> to <span class="string">&quot;Android&quot;</span>,</span><br><span class="line">                     <span class="number">2</span> to <span class="string">&quot;Ali&quot;</span>,</span><br><span class="line">                     <span class="number">3</span> to <span class="string">&quot;Mindorks&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h3><p>Java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java 7 and below</span></span><br><span class="line"><span class="keyword">for</span> (Car car : cars) &#123;</span><br><span class="line">  System.out.println(car.speed);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Java 8+</span></span><br><span class="line">cars.forEach(car -&gt; System.out.println(car.speed));</span><br><span class="line"></span><br><span class="line"><span class="comment">// Java 7 and below</span></span><br><span class="line"><span class="keyword">for</span> (Car car : cars) &#123;</span><br><span class="line">  <span class="keyword">if</span> (car.speed &gt; <span class="number">100</span>) &#123;</span><br><span class="line">    System.out.println(car.speed);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Java 8+</span></span><br><span class="line">cars.stream().filter(car -&gt; car.speed &gt; <span class="number">100</span>).forEach(car -&gt; System.out.println(car.speed));</span><br></pre></td></tr></table></figure>
<p>Kotlin:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cars.forEach &#123;</span><br><span class="line">    println(it.speed)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cars.filter &#123; it.speed &gt; <span class="number">100</span> &#125;</span><br><span class="line">      .forEach &#123; println(it.speed)&#125;</span><br></pre></td></tr></table></figure>
<h3 id="方法定义"><a href="#方法定义" class="headerlink" title="方法定义"></a>方法定义</h3><p>Java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">doSomething</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="comment">// logic here</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">doSomething</span><span class="params">(<span class="keyword">int</span>... numbers)</span> </span>&#123;</span><br><span class="line">   <span class="comment">// logic here</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Kotlin:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">doSomething</span><span class="params">()</span></span> &#123;</span><br><span class="line">   <span class="comment">// logic here</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">doSomething</span><span class="params">(<span class="keyword">vararg</span> numbers: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">   <span class="comment">// logic here</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>###带返回值的方法</p>
<p>Java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getScore</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   <span class="comment">// logic here</span></span><br><span class="line">   <span class="keyword">return</span> score;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Kotlin:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">getScore</span><span class="params">()</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">   <span class="comment">// logic here</span></span><br><span class="line">   <span class="keyword">return</span> score</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// as a single-expression function</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">getScore</span><span class="params">()</span></span>: <span class="built_in">Int</span> = score</span><br></pre></td></tr></table></figure>
<p>###无结束符号</p>
<p>Java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getScore</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// logic here</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span> * value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Kotlin:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">getScore</span><span class="params">(value: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">   <span class="comment">// logic here</span></span><br><span class="line">   <span class="keyword">return</span> <span class="number">2</span> * value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// as a single-expression function</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">getScore</span><span class="params">(value: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> = <span class="number">2</span> * value</span><br></pre></td></tr></table></figure>
<h3 id="Constructor-构造器"><a href="#Constructor-构造器" class="headerlink" title="Constructor 构造器"></a>Constructor 构造器</h3><p>Java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Utils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Utils</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">// This utility class is not publicly instantiable</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">getScore</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Kotlin:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Utils</span> <span class="keyword">private</span> <span class="keyword">constructor</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">companion</span> <span class="keyword">object</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">fun</span> <span class="title">getScore</span><span class="params">(value: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">2</span> * value</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// another way</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">object</span> Utils &#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">getScore</span><span class="params">(value: <span class="type">Int</span>)</span></span>: <span class="built_in">Int</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * value</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="GetSet-构造器"><a href="#GetSet-构造器" class="headerlink" title="GetSet 构造器"></a>GetSet 构造器</h3><p>Java：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Developer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Developer</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(<span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Kotlin:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Developer</span></span>(<span class="keyword">val</span> name: String, <span class="keyword">val</span> age: <span class="built_in">Int</span>)</span><br></pre></td></tr></table></figure>
<h2 id="必备基础"><a href="#必备基础" class="headerlink" title="必备基础"></a>必备基础</h2><p>学习新语言，第一步就是学习它有怎样的数据类型，以及它的数组集合和方法是怎样子，因为这些事我们入手一门新语言时的第一步，也是基础汇总的基础。</p>
<h3 id="Kotlin基本类型"><a href="#Kotlin基本类型" class="headerlink" title="Kotlin基本类型"></a>Kotlin基本类型</h3><h4 id="数字"><a href="#数字" class="headerlink" title="数字"></a>数字</h4><p>Kotlin 提供了一组表示数字的内置类型。 对于整数，有四种不同大小的类型，因此值的范围也不同。</p>
<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">大小（比特数）</th>
<th align="left">最小值</th>
<th align="left">最大值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Byte</td>
<td align="left">8</td>
<td align="left">-128</td>
<td align="left">127</td>
</tr>
<tr>
<td align="left">Short</td>
<td align="left">16</td>
<td align="left">-32768</td>
<td align="left">32767</td>
</tr>
<tr>
<td align="left">Int</td>
<td align="left">32</td>
<td align="left">-2,147,483,648 (-231)</td>
<td align="left">2,147,483,647 (231 - 1)</td>
</tr>
<tr>
<td align="left">Long</td>
<td align="left">64</td>
<td align="left">-9,223,372,036,854,775,808 (-263)</td>
<td align="left">9,223,372,036,854,775,807 (263 - 1)</td>
</tr>
</tbody></table>
<p>对于浮点数，Kotlin 提供了 <code>Float</code> 与 <code>Double</code> 类型。 根据 <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/IEEE_754">IEEE 754 标准</a>， 两种浮点类型的<em>十进制位数</em>（即可以存储多少位十进制数）不同。 <code>Float</code> 反映了 IEEE 754 <em>单精度</em>，而 <code>Double</code> 提供了<em>双精度</em>。</p>
<table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">大小（比特数）</th>
<th align="left">有效数字比特数</th>
<th align="left">指数比特数</th>
<th align="left">十进制位数</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Float</td>
<td align="left">32</td>
<td align="left">24</td>
<td align="left">8</td>
<td align="left">6-7</td>
</tr>
<tr>
<td align="left">Double</td>
<td align="left">64</td>
<td align="left">53</td>
<td align="left">11</td>
<td align="left">15-16</td>
</tr>
</tbody></table>
<h3 id="Kotlin的数组"><a href="#Kotlin的数组" class="headerlink" title="Kotlin的数组"></a>Kotlin的数组</h3><p>数组在 Kotlin 中使用 <code>Array</code> 类来表示，它定义了 <code>get</code> 与 <code>set</code> 函数（按照运算符重载约定这会转变为 <code>[]</code>）以及 <code>size</code> 属性，以及一些其他有用的成员函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class Array&lt;T&gt; private constructor() &#123;</span><br><span class="line">    val size: Int</span><br><span class="line">    operator fun get(index: Int): T</span><br><span class="line">    operator fun set(index: Int, value: T): Unit</span><br><span class="line"></span><br><span class="line">    operator fun iterator(): Iterator&lt;T&gt;</span><br><span class="line">    &#x2F;&#x2F; ……</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="数组的创建技巧"><a href="#数组的创建技巧" class="headerlink" title="数组的创建技巧"></a>数组的创建技巧</h4><p>我们可以使用库函数 <code>arrayOf()</code> 来创建一个数组并传递元素值给它，这样 <code>arrayOf(1, 2, 3)</code> 创建了 array <code>[1, 2, 3]</code>。 或者，库函数 <code>arrayOfNulls()</code> 可以用于创建一个指定大小的、所有元素都为空的数组。</p>
<p>另一个选项是用接受数组大小以及一个函数参数的 <code>Array</code> 构造函数，用作参数的函数能够返回给定索引的每个元素初始值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 创建一个 Array&lt;String&gt; 初始化为 [&quot;0&quot;, &quot;1&quot;, &quot;4&quot;, &quot;9&quot;, &quot;16&quot;]</span><br><span class="line">val asc &#x3D; Array(5) &#123; i -&gt; (i * i).toString() &#125;</span><br><span class="line">asc.forEach &#123; println(it) &#125;</span><br></pre></td></tr></table></figure>
<p>如上所述，<code>[]</code> 运算符代表调用成员函数 <code>get()</code> 与 <code>set()</code>。</p>
<p>Kotlin 中数组是<em>不型变的（invariant）</em>。这意味着 Kotlin 不让我们把 <code>Array&lt;String&gt;</code> 赋值给 <code>Array&lt;Any&gt;</code>，以防止可能的运行时失败。</p>
<h4 id="原生类型数组"><a href="#原生类型数组" class="headerlink" title="原生类型数组"></a>原生类型数组</h4><p>Kotlin 也有无装箱开箱的专门的类来表示原生类型数组: <code>ByteArray</code>、 <code>ShortArray</code>、<code>IntArray</code> 等等。这些类与 <code>Array</code> 并没有继承关系，但是它们有同样的方法属性集。它们也都有相应的工厂方法:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> x: IntArray = intArrayOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">x[<span class="number">0</span>] = x[<span class="number">1</span>] + x[<span class="number">2</span>]</span><br><span class="line"><span class="comment">// 大小为 5、值为 [0, 0, 0, 0, 0] 的整型数组</span></span><br><span class="line"><span class="keyword">val</span> arr = IntArray(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 例如：用常量初始化数组中的值</span></span><br><span class="line"><span class="comment">// 大小为 5、值为 [42, 42, 42, 42, 42] 的整型数组</span></span><br><span class="line"><span class="keyword">val</span> arr = IntArray(<span class="number">5</span>) &#123; <span class="number">42</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 例如：使用 lambda 表达式初始化数组中的值</span></span><br><span class="line"><span class="comment">// 大小为 5、值为 [0, 1, 2, 3, 4] 的整型数组（值初始化为其索引值）</span></span><br><span class="line"><span class="keyword">var</span> arr = IntArray(<span class="number">5</span>) &#123; it * <span class="number">1</span> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="Kotlin数组的遍历"><a href="#Kotlin数组的遍历" class="headerlink" title="Kotlin数组的遍历"></a>Kotlin数组的遍历</h4><h5 id="数组遍历"><a href="#数组遍历" class="headerlink" title="数组遍历"></a>数组遍历</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (item <span class="keyword">in</span> array) &#123;</span><br><span class="line">    println(item)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="带索引遍历数组"><a href="#带索引遍历数组" class="headerlink" title="带索引遍历数组"></a>带索引遍历数组</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> array.indices) &#123;</span><br><span class="line">    println(i.toString() + <span class="string">&quot;-&gt;&quot;</span> + array[i])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="遍历元素（带索引）"><a href="#遍历元素（带索引）" class="headerlink" title="遍历元素（带索引）"></a>遍历元素（带索引）</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ((index, item) <span class="keyword">in</span> array.withIndex()) &#123;</span><br><span class="line">    println(<span class="string">&quot;<span class="variable">$index</span>-&gt;<span class="variable">$item</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="forEach遍历数组"><a href="#forEach遍历数组" class="headerlink" title="forEach遍历数组"></a>forEach遍历数组</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">array.forEach &#123; println(it) &#125;</span><br></pre></td></tr></table></figure>
<h5 id="forEach增强版"><a href="#forEach增强版" class="headerlink" title="forEach增强版"></a>forEach增强版</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">array.forEachIndexed &#123;</span><br><span class="line">	println(<span class="string">&quot;<span class="variable">$index</span>: <span class="variable">$item</span>&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Kotlin集合"><a href="#Kotlin集合" class="headerlink" title="Kotlin集合"></a>Kotlin集合</h3><p>Kotlin 标准库提供了一整套用于管理<em>集合</em>的工具，集合是可变数量（可能为零）的一组条目，各种集合对于解决问题都具有重要意义，并且经常用到。</p>
<ul>
<li><em>List</em> 是一个有序集合，可通过索引（反映元素位置的整数）访问元素。元素可以在 list 中出现多次。列表的一个示例是一句话：有一组字、这些字的顺序很重要并且字可以重复。</li>
<li><em>Set</em> 是唯一元素的集合。它反映了集合（set）的数学抽象：一组无重复的对象。一般来说 set 中元素的顺序并不重要。例如，字母表是字母的集合（set）。</li>
<li><em>Map</em>（或者<em>字典</em>）是一组键值对。键是唯一的，每个键都刚好映射到一个值。值可以重复。map 对于存储对象之间的逻辑连接非常有用，例如，员工的 ID 与员工的位置。</li>
</ul>
<h4 id="集合的可变性与不可变性"><a href="#集合的可变性与不可变性" class="headerlink" title="集合的可变性与不可变性"></a>集合的可变性与不可变性</h4><p>Kotlin中存在两种意义上的集合，一种是可以修改的，一种是不可以修改的。</p>
<h5 id="不可变集合"><a href="#不可变集合" class="headerlink" title="不可变集合"></a>不可变集合</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> stringList = listOf(<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;one&quot;</span>)</span><br><span class="line">println(stringList)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> stringSet = setOf(<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;three&quot;</span>)</span><br><span class="line">println(stringSet)</span><br></pre></td></tr></table></figure>
<h5 id="可变集合（list-前面加mutable）"><a href="#可变集合（list-前面加mutable）" class="headerlink" title="可变集合（list 前面加mutable）"></a>可变集合（list 前面加mutable）</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> numbers = mutableListOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">numbers.add(<span class="number">5</span>)</span><br><span class="line">numbers.removeAt(<span class="number">1</span>)</span><br><span class="line">numbers[<span class="number">0</span>] = <span class="number">0</span></span><br><span class="line">println(numbers)</span><br></pre></td></tr></table></figure>
<p>不难发现，每个不可变集合都有对应的可变集合，也就是以mutable为前缀的集合。</p>
<h5 id="集合排序"><a href="#集合排序" class="headerlink" title="集合排序"></a>集合排序</h5><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> numbers = mutableListOf(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="comment">//随机排列元素</span></span><br><span class="line">numbers.shuffle()</span><br><span class="line">println(numbers)</span><br><span class="line">numbers.sort()<span class="comment">//排序，从小打到</span></span><br><span class="line">numbers.sortDescending()<span class="comment">//从大到小</span></span><br><span class="line">println(numbers)</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义一个Person类，有name 和 age 两属性</span></span><br><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Language</span></span>(<span class="keyword">var</span> name: String, <span class="keyword">var</span> score: <span class="built_in">Int</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> languageList: MutableList&lt;Language&gt; = mutableListOf()</span><br><span class="line">languageList.add(Language(<span class="string">&quot;Java&quot;</span>, <span class="number">80</span>))</span><br><span class="line">languageList.add(Language(<span class="string">&quot;Kotlin&quot;</span>, <span class="number">90</span>))</span><br><span class="line">languageList.add(Language(<span class="string">&quot;Dart&quot;</span>, <span class="number">99</span>))</span><br><span class="line">languageList.add(Language(<span class="string">&quot;C&quot;</span>, <span class="number">80</span>))</span><br><span class="line"><span class="comment">//使用sortBy进行排序，适合单条件排序</span></span><br><span class="line">languageList.sortBy &#123; it.score &#125;</span><br><span class="line">println(languageList)</span><br><span class="line"><span class="comment">//使用sortWith进行排序，适合多条件排序</span></span><br><span class="line">languageList.sortWith(compareBy(</span><br><span class="line">        <span class="comment">//it变量是lambda中的隐式参数</span></span><br><span class="line">        &#123; it.score &#125;, &#123; it.name &#125;)</span><br><span class="line">)</span><br><span class="line">println(languageList)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="Set和Map"><a href="#Set和Map" class="headerlink" title="Set和Map"></a>Set和Map</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**set**/</span></span><br><span class="line"><span class="keyword">val</span> hello = mutableSetOf(<span class="string">&quot;H&quot;</span>, <span class="string">&quot;e&quot;</span>, <span class="string">&quot;l&quot;</span>, <span class="string">&quot;l&quot;</span>, <span class="string">&quot;o&quot;</span>)<span class="comment">//自动过滤重复元素</span></span><br><span class="line">hello.remove(<span class="string">&quot;o&quot;</span>)</span><br><span class="line"><span class="comment">//集合的加减操作，前面的集合必须是可变集合</span></span><br><span class="line">hello += setOf(<span class="string">&quot;w&quot;</span>, <span class="string">&quot;o&quot;</span>, <span class="string">&quot;r&quot;</span>, <span class="string">&quot;l&quot;</span>, <span class="string">&quot;d&quot;</span>)</span><br><span class="line">println(hello)</span><br><span class="line"></span><br><span class="line"><span class="comment">/**Map&lt;K, V&gt; 不是 Collection 接口的继承者；但是它也是 Kotlin 的一种集合类型**/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> numbersMap = mapOf(<span class="string">&quot;key1&quot;</span> to <span class="number">1</span>, <span class="string">&quot;key2&quot;</span> to <span class="number">2</span>, <span class="string">&quot;key3&quot;</span> to <span class="number">3</span>, <span class="string">&quot;key4&quot;</span> to <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">println(<span class="string">&quot;All keys: <span class="subst">$&#123;numbersMap.keys&#125;</span>&quot;</span>)</span><br><span class="line">println(<span class="string">&quot;All values: <span class="subst">$&#123;numbersMap.values&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> (<span class="string">&quot;key2&quot;</span> <span class="keyword">in</span> numbersMap) println(<span class="string">&quot;Value by key \&quot;key2\&quot;: <span class="subst">$&#123;numbersMap[<span class="string">&quot;key2&quot;</span>]&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> (<span class="number">1</span> <span class="keyword">in</span> numbersMap.values) println(<span class="string">&quot;1 is in the map&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> (numbersMap.containsValue(<span class="number">1</span>)) println(<span class="string">&quot; 1 is in the map&quot;</span>)</span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Q1 : 两个具有相同键值对，但顺序不同对Map相等么？为什么？</span></span><br><span class="line"><span class="comment">     * 无论顺序如何，包含相同键值对对两个Map是相等的</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">val</span> anotherMap = mapOf(<span class="string">&quot;key2&quot;</span> to <span class="number">2</span> ,<span class="string">&quot;key1&quot;</span> to <span class="number">1</span>,<span class="string">&quot;key3&quot;</span> to <span class="number">3</span>,<span class="string">&quot;key4&quot;</span> to <span class="number">4</span>)</span><br><span class="line">    println(<span class="string">&quot;anotherMap == numberMap:<span class="subst">$&#123;anotherMap == numberMap&#125;</span>&quot;</span>)</span><br><span class="line">		<span class="comment">// == 会调用 Any 的equals方法</span></span><br><span class="line">    anotherMap.equals(numberMap)</span><br></pre></td></tr></table></figure>
<h4 id="Q1-两个具有相同键值对，但顺序不同对Map相等么？为什么？"><a href="#Q1-两个具有相同键值对，但顺序不同对Map相等么？为什么？" class="headerlink" title="Q1: 两个具有相同键值对，但顺序不同对Map相等么？为什么？"></a>Q1: 两个具有相同键值对，但顺序不同对Map相等么？为什么？</h4><p><strong>A:</strong> 无论顺序如何，包含相同键值对对两个Map是相等的</p>
<p>Debug 进入源码：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> boolean equals(Object o) &#123;</span><br><span class="line">  		<span class="comment">// 如果内存地址一致，返回true</span></span><br><span class="line">     <span class="keyword">if</span> (o == <span class="keyword">this</span>)</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	<span class="comment">//如果比较的对象不是Map ，返回 false</span></span><br><span class="line">     <span class="keyword">if</span> (!(o instanceof Map))</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">     Map&lt;?,?&gt; m = (Map&lt;?,?&gt;) o;</span><br><span class="line">  		<span class="comment">// Map的size不相等，返回false</span></span><br><span class="line">     <span class="keyword">if</span> (m.size() != size())</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	<span class="comment">//遍历两个Map的Key和Value，如果有不相等的，则返回false，否则将会返回true</span></span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">         Iterator&lt;Entry&lt;K,V&gt;&gt; i = entrySet().iterator();</span><br><span class="line">         <span class="keyword">while</span> (i.hasNext()) &#123;</span><br><span class="line">             Entry&lt;K,V&gt; e = i.next();</span><br><span class="line">             K key = e.getKey();</span><br><span class="line">             V value = e.getValue();</span><br><span class="line">             <span class="keyword">if</span> (value == <span class="literal">null</span>) &#123;</span><br><span class="line">                 <span class="keyword">if</span> (!(m.<span class="keyword">get</span>(key)==<span class="literal">null</span> &amp;&amp; m.containsKey(key)))</span><br><span class="line">                     <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">             &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                 <span class="keyword">if</span> (!value.equals(m.<span class="keyword">get</span>(key)))</span><br><span class="line">                     <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125; <span class="keyword">catch</span> (ClassCastException unused) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">     &#125; <span class="keyword">catch</span> (NullPointerException unused) &#123;</span><br><span class="line">         <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="Q2-两个具有相同元素，但顺序不同的list相等吗？"><a href="#Q2-两个具有相同元素，但顺序不同的list相等吗？" class="headerlink" title="Q2: 两个具有相同元素，但顺序不同的list相等吗？"></a>Q2: 两个具有相同元素，但顺序不同的list相等吗？</h4><p>不相等，debug进入源码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line"><span class="comment">// 如果内存地址一致，返回true</span></span><br><span class="line">    <span class="keyword">if</span> (o == <span class="keyword">this</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line"><span class="comment">//如果比较的对象不是List，返回 false</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!(o <span class="keyword">instanceof</span> List))</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"><span class="comment">//初始化迭代器</span></span><br><span class="line">    ListIterator&lt;E&gt; e1 = listIterator();</span><br><span class="line">    ListIterator&lt;?&gt; e2 = ((List&lt;?&gt;) o).listIterator();</span><br><span class="line">  </span><br><span class="line">   <span class="comment">// 比昂里两个list，如果不同返回false</span></span><br><span class="line">    <span class="keyword">while</span> (e1.hasNext() &amp;&amp; e2.hasNext()) &#123;</span><br><span class="line">        E o1 = e1.next();</span><br><span class="line">        Object o2 = e2.next();</span><br><span class="line">        <span class="keyword">if</span> (!(o1==<span class="keyword">null</span> ? o2==<span class="keyword">null</span> : o1.equals(o2)))</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">//两个list的迭代器hasNext都返回false时候（已经遍历结束），方法返回true，否则返回false（说明list长度不同）</span></span><br><span class="line">    <span class="keyword">return</span> !(e1.hasNext() || e2.hasNext());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/30/%E6%8E%92%E5%BA%8F%EF%BC%88%E4%B8%8A%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="oldnineping">
      <meta itemprop="description" content="技术日记和杂七杂八的dx">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="地球上的小东西">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/30/%E6%8E%92%E5%BA%8F%EF%BC%88%E4%B8%8A%EF%BC%89/" class="post-title-link" itemprop="url">排序（上）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-03-30 16:52:10" itemprop="dateCreated datePublished" datetime="2021-03-30T16:52:10+08:00">2021-03-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-25 17:27:32" itemprop="dateModified" datetime="2021-06-25T17:27:32+08:00">2021-06-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">数据结构与算法</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E6%8E%92%E5%BA%8F/" itemprop="url" rel="index"><span itemprop="name">排序</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Geek时间：排序（上）原地排序-笔记"><a href="#Geek时间：排序（上）原地排序-笔记" class="headerlink" title="Geek时间：排序（上）原地排序 笔记"></a>Geek时间：排序（上）原地排序 笔记</h1>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/03/30/%E6%8E%92%E5%BA%8F%EF%BC%88%E4%B8%8A%EF%BC%89/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/24/HashMap%E5%8E%9F%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="oldnineping">
      <meta itemprop="description" content="技术日记和杂七杂八的dx">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="地球上的小东西">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/24/HashMap%E5%8E%9F%E7%90%86/" class="post-title-link" itemprop="url">HashMap原理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-03-24 18:52:34" itemprop="dateCreated datePublished" datetime="2021-03-24T18:52:34+08:00">2021-03-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-25 17:27:32" itemprop="dateModified" datetime="2021-06-25T17:27:32+08:00">2021-06-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/HashMap/" itemprop="url" rel="index"><span itemprop="name">HashMap</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <a id="more"></a>

<h2 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h2><h2 id="第一部分：基础入门"><a href="#第一部分：基础入门" class="headerlink" title="第一部分：基础入门"></a>第一部分：基础入门</h2><h3 id="1-数组的优势劣势"><a href="#1-数组的优势劣势" class="headerlink" title="1. 数组的优势劣势"></a>1. 数组的优势劣势</h3><img src="/2021/03/24/HashMap%E5%8E%9F%E7%90%86/image-20210325112849639.png" alt="image-20210325112849639" style="zoom:50%;">

<p>数组的内存是连续的，每一块空间是一样大的。</p>
<p>优势：索引速度快，数组都是有index下标的，只要拿到数组的引用，就可以根据index快速访问到指定的位置。</p>
<p>劣势：因为Java中的内存申请完之后大小是固定的，想插入新的数据只能申请一个块更大的内存空间，将旧数组的数据导入新数组后再插入新数据，不灵活且浪费性能</p>
<h3 id="2-链表的优势劣势"><a href="#2-链表的优势劣势" class="headerlink" title="2. 链表的优势劣势"></a>2. 链表的优势劣势</h3><img src="/2021/03/24/HashMap%E5%8E%9F%E7%90%86/image-20210325113508084.png" alt="image-20210325113508084" style="zoom:50%;">

<p>链表在内存中不是一段连续的空间，每一块内存都有一块小空间去保留下一块内存的地址。</p>
<p>优势：插入速度快，只要修改内存存储的指向下一个内存的引用就行了。</p>
<p>劣势：索引速度慢，链表不存在index下标，只能从头元素（Head）开始，挨个查存储的指向下一块内存地址的引用。</p>
<h3 id="3-整合两者数据结构的优势：散列表"><a href="#3-整合两者数据结构的优势：散列表" class="headerlink" title="3.整合两者数据结构的优势：散列表"></a>3.整合两者数据结构的优势：散列表</h3><p><img src="/2021/03/24/HashMap%E5%8E%9F%E7%90%86/image-20210325114151322.png" alt="image-20210325114151322"></p>
<p>数组里保存的数据是链表，这就是散列表。</p>
<h3 id="4-散列表的特点"><a href="#4-散列表的特点" class="headerlink" title="4.散列表的特点"></a>4.散列表的特点</h3><p>整合了俩者的优势，既可以利用数组的优势，index快速查找，也可以利用链表的优势快速扩容。</p>
<h3 id="5-Hash是什么"><a href="#5-Hash是什么" class="headerlink" title="5. Hash是什么"></a>5. Hash是什么</h3><p>Hash ，也成散列，Hash英文本意即为切碎。</p>
<p>基本原理：把<strong>任意长度</strong>的输入通过Hash算法变成<strong>固定长度</strong>的输出。</p>
<p>这个<strong>映射规则</strong>就是对应的Hash算法，而原始数据<strong>映射后的二进制串</strong>就是Hash值。</p>
<p>Hash的特点：</p>
<ol>
<li>从Hash值不可以<strong>反向推导</strong>出原始数据。</li>
<li>输入数据的<strong>微小变化</strong>会得到完全不同的hash值，相同的数据会得到相同的值。</li>
<li>Hash算法的执行效率要<strong>高效</strong>，长的文本也能快速 地计算出Hash值。</li>
<li>Hash算法的<strong>冲突概率要小</strong>。</li>
</ol>
<p>由于Hash的原理是将输入空间的值映射成Hash空间内，而Hash值的空间远小于输入空间。</p>
<p>根据抽屉原理，一定会存在不同的输入背映射成相同输出的情况。</p>
<p>抽屉原理：<strong>十个</strong>苹果放进九个抽屉里，无论怎么放，总有一个抽屉<strong>不少于两个</strong>苹果。</p>
<h2 id="第二部分：HashMap原理简介"><a href="#第二部分：HashMap原理简介" class="headerlink" title="第二部分：HashMap原理简介"></a>第二部分：HashMap原理简介</h2><h3 id="1-HashMap的继承体系"><a href="#1-HashMap的继承体系" class="headerlink" title="1.HashMap的继承体系"></a>1.HashMap的继承体系</h3><p><img src="/2021/03/24/HashMap%E5%8E%9F%E7%90%86/image-20210325145444000.png" alt="image-20210325145444000"></p>
<h3 id="2-Node的数据结构分析"><a href="#2-Node的数据结构分析" class="headerlink" title="2. Node的数据结构分析"></a>2. Node的数据结构分析</h3><p>HashMap的静态内部类，实现了Map.Entry接口</p>
<ul>
<li>hash：存储key 的hash值，key获取hash值后会经过一次扰动再赋值给hash，和直接调用HashCode方法得到的结果不同。</li>
<li>key，value：就是我们put进来的key-value，我们存的key-value格式的数据都会封装成 Node结构的元素存入散列表。</li>
<li>next：Hash会碰撞，碰撞后无法存入数组（因为数组中不能存入两个元素），所以只能将数据链起来形成链 表。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">   * Basic hash bin node, used for most entries.  (See below for</span></span><br><span class="line"><span class="comment">   * TreeNode subclass, and in LinkedHashMap for its Entry subclass.)</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">      <span class="keyword">final</span> <span class="keyword">int</span> hash;</span><br><span class="line">      <span class="keyword">final</span> K key;</span><br><span class="line">      V value;</span><br><span class="line">      Node&lt;K,V&gt; next;</span><br><span class="line"></span><br><span class="line">      Node(<span class="keyword">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span><br><span class="line">          <span class="keyword">this</span>.hash = hash;</span><br><span class="line">          <span class="keyword">this</span>.key = key;</span><br><span class="line">          <span class="keyword">this</span>.value = value;</span><br><span class="line">          <span class="keyword">this</span>.next = next;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> K <span class="title">getKey</span><span class="params">()</span>        </span>&#123; <span class="keyword">return</span> key; &#125;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title">getValue</span><span class="params">()</span>      </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> key + <span class="string">&quot;=&quot;</span> + value; &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> Objects.hashCode(key) ^ Objects.hashCode(value);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title">setValue</span><span class="params">(V newValue)</span> </span>&#123;</span><br><span class="line">          V oldValue = value;</span><br><span class="line">          value = newValue;</span><br><span class="line">          <span class="keyword">return</span> oldValue;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (o == <span class="keyword">this</span>)</span><br><span class="line">              <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">          <span class="keyword">if</span> (o <span class="keyword">instanceof</span> Map.Entry) &#123;</span><br><span class="line">              Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o;</span><br><span class="line">              <span class="keyword">if</span> (Objects.equals(key, e.getKey()) &amp;&amp;</span><br><span class="line">                  Objects.equals(value, e.getValue()))</span><br><span class="line">                  <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>接口 Map.Entry key ：set Value：set+get</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Entry</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the key corresponding to this entry.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the key corresponding to this entry</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalStateException implementations may, but are not</span></span><br><span class="line"><span class="comment">     *         required to, throw this exception if the entry has been</span></span><br><span class="line"><span class="comment">     *         removed from the backing map.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">K <span class="title">getKey</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the value corresponding to this entry.  If the mapping</span></span><br><span class="line"><span class="comment">     * has been removed from the backing map (by the iterator&#x27;s</span></span><br><span class="line"><span class="comment">     * &#123;<span class="doctag">@code</span> remove&#125; operation), the results of this call are undefined.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the value corresponding to this entry</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalStateException implementations may, but are not</span></span><br><span class="line"><span class="comment">     *         required to, throw this exception if the entry has been</span></span><br><span class="line"><span class="comment">     *         removed from the backing map.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">V <span class="title">getValue</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Replaces the value corresponding to this entry with the specified</span></span><br><span class="line"><span class="comment">     * value (optional operation).  (Writes through to the map.)  The</span></span><br><span class="line"><span class="comment">     * behavior of this call is undefined if the mapping has already been</span></span><br><span class="line"><span class="comment">     * removed from the map (by the iterator&#x27;s &#123;<span class="doctag">@code</span> remove&#125; operation).</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value new value to be stored in this entry</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> old value corresponding to the entry</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> UnsupportedOperationException if the &#123;<span class="doctag">@code</span> put&#125; operation</span></span><br><span class="line"><span class="comment">     *         is not supported by the backing map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ClassCastException if the class of the specified value</span></span><br><span class="line"><span class="comment">     *         prevents it from being stored in the backing map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if the backing map does not permit</span></span><br><span class="line"><span class="comment">     *         null values, and the specified value is null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalArgumentException if some property of this value</span></span><br><span class="line"><span class="comment">     *         prevents it from being stored in the backing map</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalStateException implementations may, but are not</span></span><br><span class="line"><span class="comment">     *         required to, throw this exception if the entry has been</span></span><br><span class="line"><span class="comment">     *         removed from the backing map.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">V <span class="title">setValue</span><span class="params">(V value)</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//... 还有其它方法先不看</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="3-底层数据结构介绍"><a href="#3-底层数据结构介绍" class="headerlink" title="3. 底层数据结构介绍"></a>3. 底层数据结构介绍</h3><p>它的结构就是数组+链表+红黑树</p>
<ul>
<li><p>最外层是一个Node数组结构，不指定长度的话默认初始化长度为16。</p>
</li>
<li><p>无冲突发生时链表只存储一个数据，发生冲突时数组的同位会形成一个链表。</p>
</li>
<li><p>当链表长度超过8，且HashMap中所有元素数量超过64时，链表会升级成红白树。（Jdk1.8之后才会将链表升级为红黑树）</p>
</li>
</ul>
<img src="/2021/03/24/HashMap%E5%8E%9F%E7%90%86/image-20210325152127750.png" alt="image-20210325152127750" style="zoom:50%;">

<h3 id="4-put数据原理分析-流程"><a href="#4-put数据原理分析-流程" class="headerlink" title="4. put数据原理分析 (流程)"></a>4. put数据原理分析 (流程)</h3><p><img src="/2021/03/24/HashMap%E5%8E%9F%E7%90%86/image-20210325165314183.png" alt="image-20210325165314183"></p>
<ol>
<li><p>map.put(“key值”,”value值”)</p>
</li>
<li><p>key值取得Hash值</p>
</li>
<li><p>Hash值经过<strong>扰动</strong>函数，使此Hash值更散列。</p>
</li>
<li><p>构造出Node对象 （Hash，Key，Value，Next）</p>
</li>
<li><p>使用路由算法寻找Node存放在数组的位置路由公式：</p>
<p><code>数组长度 与上 node的hash值</code></p>
<p>table（数组）的长度一定是2的次方数比如 2，16，32，64，</p>
<p>数组的长度转换成二进制 ,比如:</p>
<p>16-1 =15 转二进制 =&gt; 1111</p>
<p>32-1 =31 转二进制 =&gt; 11111</p>
<p>(table.length - 1) &amp; node hash</p>
<p>(16-1) &amp;1122 =&gt; </p>
<p>B0000 0000 1111 &amp; B0100 00110 0010 =&gt; B0010 =&gt;2</p>
<p>我们使用24位表示法，也只有后门四位是1，</p>
<p>进行 与 &amp;操作的时候前面8位都变成0了，只有后四位和hash的与 &amp;操作结果生效，转换成10进制为2</p>
<p>所以存储的位置为index = 2 </p>
</li>
</ol>
<h3 id="5-什么是Hash碰撞"><a href="#5-什么是Hash碰撞" class="headerlink" title="5.什么是Hash碰撞"></a>5.什么是Hash碰撞</h3><p>第一种，根据寻址运算后算出的结果和之前的结果相同，发生碰撞</p>
<p>接着上步的操作</p>
<p>假如hashtable（数组）的长度不变 ，新的Node转换成的hash值后四位还是0010（当然Hash值也有完全一样的可能）</p>
<p><code>B0000 0000 1111</code> &amp; <code>B前8位改变，后四位刚巧还是 0010</code> </p>
<p>由于前8位是0，与的结果还是0，只有后四位参与了运算，这后四位刚好和上一步的结果一样。</p>
<p>与的结果就仍然是 0010 ,转成10进制还是2，两个Node就会在寻址操作中存入同一个数组元素，这就发生了Hash碰撞。</p>
<p>第二种：</p>
<p>根据抽屉原理，Hash值有可能是相同的。</p>
<p>寻址的结果相同，此时如果数组的元素中已经有数据了，就要把Node中next指向这个新的元素，它就形成一个链表了。</p>
<h3 id="6-什么是链化"><a href="#6-什么是链化" class="headerlink" title="6.什么是链化"></a>6.什么是链化</h3><p>Hash 碰撞带来一个问题，假如一直发生Hash碰撞，<strong>链表的长度会变得很长</strong>，在通过key 做get的操作之后，经过寻址会找到相同的Node 头位，此时这个数组已经存储了一个很长的链表了，想要找到指定的Node最坏的情况可能要遍历整个链表才能找到和你指定的Key相同的Node<strong>，查询效率就会变得低下</strong>，原本的O(1) 效率在链表过长的情况下可能会退化成O(n)</p>
<h3 id="7-为什么引入红黑树"><a href="#7-为什么引入红黑树" class="headerlink" title="7.为什么引入红黑树"></a>7.为什么引入红黑树</h3><p>就是为了解决链化链的很长，提出的红黑树。红黑树是一个自平衡的二叉查找树，可以提高查找效率。</p>
<h3 id="8-HashMap扩容原理"><a href="#8-HashMap扩容原理" class="headerlink" title="8. HashMap扩容原理"></a>8. HashMap扩容原理</h3><p>这是以空间换时间的思想，比如一个长度为16的数组，查询的性能很差退化到O(n)了，扩大数组长度为32，桶位更多，每个数组内存储的链表长度就会减半，查询速度会快一倍。</p>
<h2 id="第三部分：-源码"><a href="#第三部分：-源码" class="headerlink" title="第三部分： 源码"></a>第三部分： 源码</h2><h3 id="1-HashMap-核心属性分析"><a href="#1-HashMap-核心属性分析" class="headerlink" title="1.HashMap 核心属性分析"></a>1.HashMap 核心属性分析</h3><p>HashMap 重要常量：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// table 默认长度    </span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">4</span>; <span class="comment">// aka 16</span></span><br><span class="line"><span class="comment">// table 最大长度</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAXIMUM_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">30</span>;</span><br><span class="line"><span class="comment">// 缺省负载因子大小 （默认）</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="number">0.75f</span>;</span><br><span class="line"><span class="comment">// 树化阈值 ，链表元素超过8 有可能树化</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TREEIFY_THRESHOLD = <span class="number">8</span>;</span><br><span class="line"><span class="comment">// 树降级阈值 </span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> UNTREEIFY_THRESHOLD = <span class="number">6</span>;</span><br><span class="line"><span class="comment">// 树化的另一个参数，当Hash表中所有元素个数超过64时，才会允许树化 capacity：容量</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MIN_TREEIFY_CAPACITY = <span class="number">64</span>;</span><br></pre></td></tr></table></figure>
<p>HashMap 核心属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Hash 表</span></span><br><span class="line"><span class="comment">*	什么时候初始化</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">transient</span> Node&lt;K,V&gt;[] table;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当前Hash表中的元素个数</span></span><br><span class="line"><span class="keyword">transient</span> <span class="keyword">int</span> size;</span><br><span class="line"><span class="comment">// 当前 Hash表 结构修改次数 （插入和修改，如果Key相同去替换不计数）</span></span><br><span class="line"><span class="keyword">transient</span> <span class="keyword">int</span> modCount;</span><br></pre></td></tr></table></figure>
<h4 id="threshold-英文含义：门槛，起始，开端"><a href="#threshold-英文含义：门槛，起始，开端" class="headerlink" title="threshold 英文含义：门槛，起始，开端"></a>threshold 英文含义：门槛，起始，开端</h4><p>扩容阈值，当你的Hash表中元素超过阈值时，触发扩容。</p>
<h4 id="loadFactory"><a href="#loadFactory" class="headerlink" title="loadFactory"></a>loadFactory</h4><p>即为负载因子，一般使用默认的大小（0.75），用它来计算扩容的阈值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">扩容阈值 = Hash表的数组长度（容量）* 负载因子</span><br><span class="line">threshold = capacity * loadFactor</span><br></pre></td></tr></table></figure>
<h4 id="size"><a href="#size" class="headerlink" title="size"></a>size</h4><p>当前Hash表中的元素个数</p>
<h4 id="modCount"><a href="#modCount" class="headerlink" title="modCount"></a>modCount</h4><p>当前 Hash表 结构修改次数 （插入和修改，如果Key相同去替换不计数）</p>
<h3 id="2-构造方法分析"><a href="#2-构造方法分析" class="headerlink" title="2.  构造方法分析"></a>2.  构造方法分析</h3><h5 id="1-两参数："><a href="#1-两参数：" class="headerlink" title="1. 两参数："></a>1. 两参数：</h5><ul>
<li>入参： <ul>
<li>HashTable能存储的元素最大值 initialCapacity，</li>
<li>负载因子的值loadFactor</li>
</ul>
</li>
<li>方法体：<ul>
<li>校验：<ul>
<li>HashTable能存储的元素最大值initialCapacity，必须大于 0 ，最大值也就是 MAX_CAPACITY,不能超过，超过久服之为MAX_CAPACITY（1&lt;&lt;30）</li>
<li>负载因子的值 loadFactor必须大于0，我们一般就用默认值0.75</li>
</ul>
</li>
<li>赋值：<ul>
<li> 给负载因子赋值loadFactor</li>
<li> 给扩容阈赋值，扩容阈赋值通过tableSizeFor方法计算而出，返回的值大于等于当前capacity值，且为2的倍数</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>&#123;</span><br><span class="line">      <span class="comment">//做了一些校验</span></span><br><span class="line">      <span class="comment">//Capacity 必须大于 0 最大值也就是 MAX_CAPACITY,不能超过</span></span><br><span class="line">      <span class="keyword">if</span> (initialCapacity &lt; <span class="number">0</span>)</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Illegal initial capacity: &quot;</span> +</span><br><span class="line">                                             initialCapacity);</span><br><span class="line">      <span class="keyword">if</span> (initialCapacity &gt; MAXIMUM_CAPACITY)</span><br><span class="line">          initialCapacity = MAXIMUM_CAPACITY;</span><br><span class="line">      <span class="comment">//loadFactor 必须 &gt; 0</span></span><br><span class="line">      <span class="keyword">if</span> (loadFactor &lt;= <span class="number">0</span> || Float.isNaN(loadFactor))</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Illegal load factor: &quot;</span> +</span><br><span class="line">                                             loadFactor);</span><br><span class="line">      <span class="comment">//给负载因子赋值</span></span><br><span class="line">      <span class="keyword">this</span>.loadFactor = loadFactor;</span><br><span class="line">      <span class="comment">//扩容阈值 =tableSizeFor的返回值</span></span><br><span class="line">		<span class="comment">//tableSizeFor  返回一个大于等于当前值cap值的一个数字，并且这个数字一定是2的次方数</span></span><br><span class="line">      <span class="keyword">this</span>.threshold = tableSizeFor(initialCapacity);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">    cap = <span class="number">10</span></span><br><span class="line">    n = <span class="number">10</span> - <span class="number">1</span> =&gt; <span class="number">9</span></span><br><span class="line">    <span class="number">0b1001</span></span><br><span class="line">    <span class="number">0b1001</span> | <span class="number">0b0100</span> =&gt; <span class="number">0b1101</span></span><br><span class="line">    <span class="number">0b1101</span> | <span class="number">0b0011</span> =&gt; <span class="number">0b1111</span></span><br><span class="line">    <span class="number">0b1111</span> | <span class="number">0b0000</span> =&gt; <span class="number">0b1111</span></span><br><span class="line">    <span class="number">0b1111</span> =&gt; <span class="number">15</span> </span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">tableSizeFor</span><span class="params">(<span class="keyword">int</span> cap)</span> </span>&#123;</span><br><span class="line">      <span class="comment">//此处不减1 会得到一个比你想要的数字大一倍的数字</span></span><br><span class="line">      <span class="keyword">int</span> n = cap - <span class="number">1</span>;</span><br><span class="line">      n |= n &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">      n |= n &gt;&gt;&gt; <span class="number">2</span>;</span><br><span class="line">      n |= n &gt;&gt;&gt; <span class="number">4</span>;</span><br><span class="line">      n |= n &gt;&gt;&gt; <span class="number">8</span>;</span><br><span class="line">      n |= n &gt;&gt;&gt; <span class="number">16</span>;</span><br><span class="line">      <span class="keyword">return</span> (n &lt; <span class="number">0</span>) ? <span class="number">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<h5 id="2-一参数：套娃了两参数方法"><a href="#2-一参数：套娃了两参数方法" class="headerlink" title="2. 一参数：套娃了两参数方法"></a>2. 一参数：套娃了两参数方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(initialCapacity, DEFAULT_LOAD_FACTOR);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="3-无参数：默认，只给负载因子赋值默认值"><a href="#3-无参数：默认，只给负载因子赋值默认值" class="headerlink" title="3. 无参数：默认，只给负载因子赋值默认值"></a>3. 无参数：默认，只给负载因子赋值默认值</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">this</span>.loadFactor = DEFAULT_LOAD_FACTOR; <span class="comment">// all other fields defaulted</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="4-传Map作为参数"><a href="#4-传Map作为参数" class="headerlink" title="4. 传Map作为参数"></a>4. 传Map作为参数</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(Map&lt;? extends K, ? extends V&gt; m)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.loadFactor = DEFAULT_LOAD_FACTOR;</span><br><span class="line">        putMapEntries(m, <span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-HashMap-put-方法分析-gt-putVal-方法分析（重点）"><a href="#3-HashMap-put-方法分析-gt-putVal-方法分析（重点）" class="headerlink" title="3.  HashMap put 方法分析 =&gt; putVal 方法分析（重点）"></a>3.  HashMap put 方法分析 =&gt; putVal 方法分析（重点）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 其实内部调用的是 putVal方法,也是个套娃方法</span></span><br><span class="line"><span class="comment">// 我们知道Node存储的hash 值，是通过key的hash值经过扰动函数后产生的，这个扰动函数就是调用putVal时调用的 hash（key）</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    			<span class="comment">//putVal 之前， key会先调用扰动函数 </span></span><br><span class="line">      		<span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 扰动函数： 作用：让key的Hash值的 高16位也参与运算，否则若HashTable的长度很短 （16），</span></span><br><span class="line"><span class="comment">* 根据路由算法</span></span><br><span class="line"><span class="comment">*（length - 1）&amp; hash，高位的数无法参与运算（高位都是0，怎么与&amp; 都是0），</span></span><br><span class="line"><span class="comment">* 所以必须经过扰动让高位参与进来，增加散列性。</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* 异或：相同则返0，不同返1</span></span><br><span class="line"><span class="comment">* hash = 0b 0010 0101 1010 1100 0011 1111 0010 1110</span></span><br><span class="line"><span class="comment">* 0b 0010 0101 1010 1100 0011 1111 0010 1110  :key的Hash值</span></span><br><span class="line"><span class="comment">* ^ 异或</span></span><br><span class="line"><span class="comment">*	0b 0000 0000 0000 0000 0010 0101 1010 1100	：key的Hash 右移16位，让高位参与运算	</span></span><br><span class="line"><span class="comment">*	0b 0010 0101 1010 1100 0001 1010 1000 0010</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">int</span> h;</span><br><span class="line">      <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// hash，key，value不必说</span></span><br><span class="line"><span class="comment">//onlyIfAbsent 如果这个key已经有值了，就不要再改变了，我们通常都传false，没有key就插入，有</span></span><br><span class="line"><span class="comment">//key就修改value</span></span><br><span class="line">  <span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></span><br><span class="line"><span class="function"><span class="params">                 <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// tab ：引用当前HashMap的散列表</span></span><br><span class="line">   	<span class="comment">// p： 当前散列表的元素</span></span><br><span class="line">    <span class="comment">// n：表示散列表数组的长度</span></span><br><span class="line">    <span class="comment">// i： 表示路由寻址的结果</span></span><br><span class="line">      Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</span><br><span class="line">    	</span><br><span class="line">    	<span class="comment">// 延迟初始化逻辑，第一次调用putVal时会初始化HashMap中最耗内存的散列表</span></span><br><span class="line">      <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">          n = (tab = resize()).length;</span><br><span class="line">    </span><br><span class="line">    	<span class="comment">//1. 最简单的一种情况，寻址找到的桶位，刚好是null，这时直接将当前k-v =&gt; node 扔进去就可以了</span></span><br><span class="line">      <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</span><br><span class="line">          tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// e： 不为null的话，找到了一个蛋清要插入的key-value一致的key的元素，（临时node）</span></span><br><span class="line">        <span class="comment">// k： 表示临时的一个key</span></span><br><span class="line">          Node&lt;K,V&gt; e; K k;</span><br><span class="line">        <span class="comment">//2.表示该桶位中的第一个元素与你当前插入的node元素的key一致，表示后续要进行替换操作</span></span><br><span class="line">          <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">              ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">              e = p;</span><br><span class="line">			<span class="comment">// 3.表示当前桶位已经树化了，如果树化调用putTreeVal</span></span><br><span class="line">          <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)<span class="comment">// 红黑树</span></span><br><span class="line">              e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</span><br><span class="line">        <span class="comment">// 4.当前捅位是一个链表</span></span><br><span class="line">          <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 4.1 条件成立的话，迭代到最后一个元素了，也没找到一个与你要插入的key一致的node，说明需要加入到当前链表的末尾（尾插法）</span></span><br><span class="line">              <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                  <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                      p.next = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">                    	<span class="comment">//条件成立的话，说明当前链表的长度达到树化标准了，需要进行树化</span></span><br><span class="line">                      <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                        	<span class="comment">// 树化操作</span></span><br><span class="line">                          treeifyBin(tab, hash);</span><br><span class="line">                      <span class="keyword">break</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                </span><br><span class="line">                  <span class="comment">//4.2条件成立的话，说明找到了相同key的node元素，需要进行替换操作</span></span><br><span class="line">                  <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                      ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                      <span class="keyword">break</span>;</span><br><span class="line">                	<span class="comment">//跳出循环后替换</span></span><br><span class="line">                  p = e;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        <span class="comment">//e 不等于null，条件成立说明，找到了一个与你插入元素key完全一致的数据，需要进行替换</span></span><br><span class="line">          <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">              V oldValue = e.value;</span><br><span class="line">              <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</span><br><span class="line">                  e.value = value;</span><br><span class="line">              afterNodeAccess(e);</span><br><span class="line">              <span class="keyword">return</span> oldValue;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    	<span class="comment">// 散列表结构背修改的次数（替换Node元素的value不计数）</span></span><br><span class="line">      ++modCount;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//插入新元素size自增，如果自增后的值大于扩容阈值，则触发扩容。</span></span><br><span class="line">      <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">          resize();</span><br><span class="line">      afterNodeInsertion(evict);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h3 id="4-HashMap-resize-扩容方法分析（核心）"><a href="#4-HashMap-resize-扩容方法分析（核心）" class="headerlink" title="4. HashMap resize 扩容方法分析（核心）"></a>4. HashMap resize 扩容方法分析（核心）</h3><p>当在table长度位16中的元素移到table长度位32的table中的时候；我们可以知道，原来在15这个槽位的元素的hash()值的后四位一定是1111（因为跟1111即table长度-1 进行与运算得到了1111）。所以所以当table长度变为32的时候，原来在15这个槽位的元素要么还在15这个槽位，要么在31这个操作（因为原来15这个槽位的元素后五位一定是11111或者01111，跟 11111即table新长度-1 进行与运算一定得到 01111或者11111）</p>
<img src="/2021/03/24/HashMap%E5%8E%9F%E7%90%86/image-20210330113906260.png" alt="image-20210330113906260" style="zoom:50%;">

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对table进行初始化或者扩容。</span></span><br><span class="line"><span class="comment"> * 如果table为null，则对table进行初始化</span></span><br><span class="line"><span class="comment"> * 如果对table扩容，因为每次扩容都是翻倍，与原来计算（n-1）&amp;hash的结果相比，节点要么就在原来的位置，要么就被分配到“原位置+旧容量”这个位置。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">    <span class="keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;</span><br><span class="line">        Node&lt;K,V&gt;[] oldTab = table;</span><br><span class="line">        <span class="comment">// oldCap表示扩容之前table数组的长度</span></span><br><span class="line">        <span class="keyword">int</span> oldCap = (oldTab == <span class="keyword">null</span>) ? <span class="number">0</span> : oldTab.length;</span><br><span class="line">        <span class="comment">// oldThr表示本次扩容之前的阈值，触发本次扩容操作的阈值</span></span><br><span class="line">        <span class="keyword">int</span> oldThr = threshold;</span><br><span class="line">        <span class="comment">// newCap：表示扩容之后table数组的大小； newThr表示扩容之后，下次触发扩容的阈值</span></span><br><span class="line">        <span class="keyword">int</span> newCap, newThr = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//===================给newCap和newThr赋值start=============================</span></span><br><span class="line">        <span class="comment">// oldCap大于零，说明之前已经初始化过了（hashmap中的散列表不是null），要进行正常的扩容操作</span></span><br><span class="line">        <span class="keyword">if</span> (oldCap &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 已经最大值了，不再扩容了</span></span><br><span class="line">            <span class="keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</span><br><span class="line">                threshold = Integer.MAX_VALUE;</span><br><span class="line">                <span class="keyword">return</span> oldTab;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// （1）进行翻倍扩容(假如旧的oldCap为8， &lt; DEFAULT_INITIAL_CAPACITY，那么此条件不成立newThr将不会赋值)</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;</span><br><span class="line">                    oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</span><br><span class="line">                newThr = oldThr &lt;&lt; <span class="number">1</span>; <span class="comment">// double threshold</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// （2）</span></span><br><span class="line">        <span class="comment">// oldCap == 0（说明hashmap中的散列表是null）且oldThr &gt; 0 ；下面几种情况都会出现oldCap == 0,oldThr &gt; 0</span></span><br><span class="line">        <span class="comment">// 1.public HashMap(int initialCapacity);</span></span><br><span class="line">        <span class="comment">// 2.public HashMap(Map&lt;? extends K, ? extends V&gt; m);并且这个map有数据</span></span><br><span class="line">        <span class="comment">// 3.public HashMap(int initialCapacity, float loadFactor);</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (oldThr &gt; <span class="number">0</span>) <span class="comment">// initial capacity was placed in threshold</span></span><br><span class="line">            newCap = oldThr;</span><br><span class="line">        <span class="comment">// oldCap == 0, oldThr == 0</span></span><br><span class="line">        <span class="comment">// public HashMap();</span></span><br><span class="line">        <span class="keyword">else</span> &#123;               <span class="comment">// zero initial threshold signifies using defaults</span></span><br><span class="line">            newCap = DEFAULT_INITIAL_CAPACITY;</span><br><span class="line">            newThr = (<span class="keyword">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 对应上面（1）不成立或者（2）成立的情况</span></span><br><span class="line">        <span class="keyword">if</span> (newThr == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">float</span> ft = (<span class="keyword">float</span>)newCap * loadFactor;</span><br><span class="line">            newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class="keyword">float</span>)MAXIMUM_CAPACITY ?</span><br><span class="line">                    (<span class="keyword">int</span>)ft : Integer.MAX_VALUE);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//===================给newCap和newThr赋值end=============================</span></span><br><span class="line">        threshold = newThr;</span><br><span class="line">        <span class="meta">@SuppressWarnings(&#123;&quot;rawtypes&quot;,&quot;unchecked&quot;&#125;)</span></span><br><span class="line">        Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="keyword">new</span> Node[newCap];</span><br><span class="line">        table = newTab;</span><br><span class="line">        <span class="keyword">if</span> (oldTab != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; oldCap; ++j) &#123;</span><br><span class="line">                Node&lt;K,V&gt; e;</span><br><span class="line">                <span class="comment">// 头结点不为空</span></span><br><span class="line">                <span class="keyword">if</span> ((e = oldTab[j]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// 将对应的桶位指向null，方便jvm回收</span></span><br><span class="line">                    oldTab[j] = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 1.如果只有一个节点</span></span><br><span class="line">                    <span class="keyword">if</span> (e.next == <span class="keyword">null</span>)</span><br><span class="line">                        newTab[e.hash &amp; (newCap - <span class="number">1</span>)] = e;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 2.树化了</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                        ((TreeNode&lt;K,V&gt;)e).split(<span class="keyword">this</span>, newTab, j, oldCap);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 3.还是链表</span></span><br><span class="line">                    <span class="keyword">else</span> &#123; <span class="comment">// preserve order</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                        <span class="comment">// 低位链表：存放在扩容之后的数组下标的位置，与当前数组下标位置一致的元素</span></span><br><span class="line">                        <span class="comment">// 高位链表：存放在扩容之后的数组下标的位置为当前数组下标位置+ 扩容之前数组长度的元素</span></span><br><span class="line">                        Node&lt;K,V&gt; loHead = <span class="keyword">null</span>, loTail = <span class="keyword">null</span>;</span><br><span class="line">                        Node&lt;K,V&gt; hiHead = <span class="keyword">null</span>, hiTail = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                        Node&lt;K,V&gt; next;</span><br><span class="line">                        <span class="keyword">do</span> &#123;</span><br><span class="line">                            next = e.next;</span><br><span class="line"></span><br><span class="line">                            <span class="comment">// 比如e.hash只能为两种可能  1 1111 或者 0 1111 ， oldCap 为 10000</span></span><br><span class="line"></span><br><span class="line">                            <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123;</span><br><span class="line">                                <span class="keyword">if</span> (loTail == <span class="keyword">null</span>)</span><br><span class="line">                                    loHead = e;</span><br><span class="line">                                <span class="keyword">else</span></span><br><span class="line">                                    loTail.next = e;</span><br><span class="line">                                loTail = e;</span><br><span class="line">                            &#125;</span><br><span class="line">                            <span class="keyword">else</span> &#123;</span><br><span class="line">                                <span class="keyword">if</span> (hiTail == <span class="keyword">null</span>)</span><br><span class="line">                                    hiHead = e;</span><br><span class="line">                                <span class="keyword">else</span></span><br><span class="line">                                    hiTail.next = e;</span><br><span class="line">                                hiTail = e;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">while</span> ((e = next) != <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// 如果低位链表有数据</span></span><br><span class="line">                        <span class="keyword">if</span> (loTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                            loTail.next = <span class="keyword">null</span>;</span><br><span class="line">                            newTab[j] = loHead;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="comment">// 如果高位链表有数据</span></span><br><span class="line">                        <span class="keyword">if</span> (hiTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                            hiTail.next = <span class="keyword">null</span>;</span><br><span class="line">                            newTab[j + oldCap] = hiHead;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> newTab;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-HashMap-get-方法分析"><a href="#5-HashMap-get-方法分析" class="headerlink" title="5. HashMap get 方法分析"></a>5. HashMap get 方法分析</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        Node&lt;K,V&gt; e;</span><br><span class="line">        <span class="keyword">return</span> (e = getNode(hash(key), key)) == <span class="keyword">null</span> ? <span class="keyword">null</span> : e.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">getNode</span><span class="params">(<span class="keyword">int</span> hash, Object key)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// tab：引用当前hashmap的table</span></span><br><span class="line">        <span class="comment">// first：桶位中的头元素</span></span><br><span class="line">        <span class="comment">// n：table的长度</span></span><br><span class="line">        <span class="comment">// e：是临时Node元素</span></span><br><span class="line">        <span class="comment">// k：是key的临时变量</span></span><br><span class="line">        Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; <span class="keyword">int</span> n; K k;</span><br><span class="line">       </span><br><span class="line">       <span class="comment">// 1.如果哈希表为空，或key对应的桶为空，返回null</span></span><br><span class="line">        <span class="keyword">if</span> ((tab = table) != <span class="keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">                (first = tab[(n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 2.这个桶的头元素就是想要找的</span></span><br><span class="line">            <span class="keyword">if</span> (first.hash == hash &amp;&amp; <span class="comment">// always check first node</span></span><br><span class="line">                    ((k = first.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                <span class="keyword">return</span> first;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// 说明当前桶位不止一个元素，可能是链表，也可能是红黑树</span></span><br><span class="line">            <span class="keyword">if</span> ((e = first.next) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 3.树化了</span></span><br><span class="line">                <span class="keyword">if</span> (first <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                    <span class="keyword">return</span> ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key);</span><br><span class="line">                </span><br><span class="line">                <span class="comment">// 4.链表</span></span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                            ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                        <span class="keyword">return</span> e;</span><br><span class="line">                &#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="6-HashMap-remove-方法分析"><a href="#6-HashMap-remove-方法分析" class="headerlink" title="6. HashMap remove 方法分析"></a>6. HashMap remove 方法分析</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">remove</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="keyword">return</span> (e = removeNode(hash(key), key, <span class="keyword">null</span>, <span class="keyword">false</span>, <span class="keyword">true</span>)) == <span class="keyword">null</span> ?</span><br><span class="line">            <span class="keyword">null</span> : e.value;</span><br><span class="line">&#125;    </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">removeNode</span><span class="params">(<span class="keyword">int</span> hash, Object key, Object value,</span></span></span><br><span class="line"><span class="function"><span class="params">                           <span class="keyword">boolean</span> matchValue, <span class="keyword">boolean</span> movable)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// tab：引用当前hashmap的table</span></span><br><span class="line">    <span class="comment">// p：当前的node元素</span></span><br><span class="line">    <span class="comment">// n：当前的散列表数组长度</span></span><br><span class="line">    <span class="comment">// index：表示寻址结果</span></span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, index;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.如果数组table为空或key映射到的桶为空，返回null。</span></span><br><span class="line">    <span class="keyword">if</span> ((tab = table) != <span class="keyword">null</span> &amp;&amp; (n = tab.length) &gt; <span class="number">0</span> &amp;&amp;</span><br><span class="line">            (p = tab[index = (n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// node：查找到的结果</span></span><br><span class="line">        <span class="comment">// e：当前Node的下一个元素</span></span><br><span class="line">        Node&lt;K,V&gt; node = <span class="keyword">null</span>, e; K k; V v;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.桶位的头元素就是我们要找的</span></span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">                ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            node = p;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((e = p.next) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 3.树化了</span></span><br><span class="line">            <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                node = ((TreeNode&lt;K,V&gt;)p).getTreeNode(hash, key);</span><br><span class="line">            <span class="comment">// 4.链表中</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">do</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                            ((k = e.key) == key ||</span><br><span class="line">                                    (key != <span class="keyword">null</span> &amp;&amp; key.equals(k)))) &#123;</span><br><span class="line">                        node = e;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    p = e;</span><br><span class="line">                &#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果node不为null，说明按照key查找到想要删除的数据了</span></span><br><span class="line">        <span class="keyword">if</span> (node != <span class="keyword">null</span> &amp;&amp; (!matchValue || (v = node.value) == value ||</span><br><span class="line">                (value != <span class="keyword">null</span> &amp;&amp; value.equals(v)))) &#123;</span><br><span class="line">            <span class="comment">// 是树，删除节点</span></span><br><span class="line">            <span class="keyword">if</span> (node <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                ((TreeNode&lt;K,V&gt;)node).removeTreeNode(<span class="keyword">this</span>, tab, movable);</span><br><span class="line">            <span class="comment">// 删除的桶的第一个元素</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (node == p)</span><br><span class="line">                tab[index] = node.next;</span><br><span class="line">            <span class="comment">// 不是第一个元素</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                p.next = node.next;</span><br><span class="line">            ++modCount;</span><br><span class="line">            --size;</span><br><span class="line">            afterNodeRemoval(node);</span><br><span class="line">            <span class="keyword">return</span> node;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="7-HashMap-replace方法分析"><a href="#7-HashMap-replace方法分析" class="headerlink" title="7. HashMap replace方法分析"></a>7. HashMap replace方法分析</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">replace</span><span class="params">(K key, V oldValue, V newValue)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt; e; V v;</span><br><span class="line">    <span class="keyword">if</span> ((e = getNode(hash(key), key)) != <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">            ((v = e.value) == oldValue || (v != <span class="keyword">null</span> &amp;&amp; v.equals(oldValue)))) &#123;</span><br><span class="line">        e.value = newValue;</span><br><span class="line">        afterNodeAccess(e);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">replace</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="keyword">if</span> ((e = getNode(hash(key), key)) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        V oldValue = e.value;</span><br><span class="line">        e.value = value;</span><br><span class="line">        afterNodeAccess(e);</span><br><span class="line">        <span class="keyword">return</span> oldValue;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="8-其它常用方法"><a href="#8-其它常用方法" class="headerlink" title="8. 其它常用方法"></a>8. 其它常用方法</h3><h4 id="isEmpty"><a href="#isEmpty" class="headerlink" title="isEmpty()"></a>isEmpty()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 如果map中没有键值对映射，返回true</span><br><span class="line"> * </span><br><span class="line"> * @return &lt;如果map中没有键值对映射，返回true</span><br><span class="line"> *&#x2F;</span><br><span class="line">public boolean isEmpty() &#123;</span><br><span class="line">    return size &#x3D;&#x3D; 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="putMapEntries"><a href="#putMapEntries" class="headerlink" title="putMapEntries()"></a>putMapEntries()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">final void putMapEntries(Map&lt;? extends K, ? extends V&gt; m, boolean evict) &#123;</span><br><span class="line">    int s &#x3D; m.size();</span><br><span class="line">    if (s &gt; 0) &#123;</span><br><span class="line">        &#x2F;&#x2F; table为null，代表这里使用HashMap(Map&lt;? extends K, ? extends V&gt; m)构造函数 或者其它方式实例化hashmap但是还没往里面添加过元素</span><br><span class="line">        if (table &#x3D;&#x3D; null) &#123; &#x2F;&#x2F; pre-size</span><br><span class="line">            &#x2F;&#x2F;前面讲到，initial capacity*load factor就是当前hashMap允许的最大元素数目。那么不难理解，s&#x2F;loadFactor+1即为应该初始化的容量。</span><br><span class="line">            float ft &#x3D; ((float)s &#x2F; loadFactor) + 1.0F;</span><br><span class="line">            int t &#x3D; ((ft &lt; (float)MAXIMUM_CAPACITY) ?</span><br><span class="line">                    (int)ft : MAXIMUM_CAPACITY);</span><br><span class="line">            if (t &gt; threshold)</span><br><span class="line">                threshold &#x3D; tableSizeFor(t);</span><br><span class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F;table已经初始化，并且map的大小大于临界值</span><br><span class="line">        else if (s &gt; threshold)</span><br><span class="line">            &#x2F;&#x2F;扩容处理</span><br><span class="line">            resize();</span><br><span class="line">        &#x2F;&#x2F;将map中所有键值对添加到hashMap中</span><br><span class="line">        for (Map.Entry&lt;? extends K, ? extends V&gt; e : m.entrySet()) &#123;</span><br><span class="line">            K key &#x3D; e.getKey();</span><br><span class="line">            V value &#x3D; e.getValue();</span><br><span class="line">            putVal(hash(key), key, value, false, evict);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="putAll"><a href="#putAll" class="headerlink" title="putAll()"></a>putAll()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 将参数map中的所有键值对映射插入到hashMap中，如果有碰撞，则覆盖value。</span><br><span class="line"> * @param m 参数map</span><br><span class="line"> * @throws NullPointerException 如果map为null</span><br><span class="line"> *&#x2F;</span><br><span class="line">public void putAll(Map&lt;? extends K, ? extends V&gt; m) &#123;</span><br><span class="line">    putMapEntries(m, true);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="clear"><a href="#clear" class="headerlink" title="clear()"></a>clear()</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 删除map中所有的键值对</span><br><span class="line"> *&#x2F;</span><br><span class="line">public void clear() &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab;</span><br><span class="line">    modCount++;</span><br><span class="line">    if ((tab &#x3D; table) !&#x3D; null &amp;&amp; size &gt; 0) &#123;</span><br><span class="line">        size &#x3D; 0;</span><br><span class="line">        for (int i &#x3D; 0; i &lt; tab.length; ++i)</span><br><span class="line">            tab[i] &#x3D; null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="containsValue-Object-value"><a href="#containsValue-Object-value" class="headerlink" title="containsValue( Object value)"></a>containsValue( Object value)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;**</span><br><span class="line"> * 如果hashMap中的键值对有一对或多对的value为参数value，返回true</span><br><span class="line"> *</span><br><span class="line"> * @param value 参数value</span><br><span class="line"> * @return 如果hashMap中的键值对有一对或多对的value为参数value，返回true</span><br><span class="line"> *&#x2F;</span><br><span class="line">public boolean containsValue(Object value) &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; V v;</span><br><span class="line">    &#x2F;&#x2F;</span><br><span class="line">    if ((tab &#x3D; table) !&#x3D; null &amp;&amp; size &gt; 0) &#123;</span><br><span class="line">        &#x2F;&#x2F;遍历数组table</span><br><span class="line">        for (int i &#x3D; 0; i &lt; tab.length; ++i) &#123;</span><br><span class="line">            &#x2F;&#x2F;遍历桶中的node</span><br><span class="line">            for (Node&lt;K,V&gt; e &#x3D; tab[i]; e !&#x3D; null; e &#x3D; e.next) &#123;</span><br><span class="line">                if ((v &#x3D; e.value) &#x3D;&#x3D; value ||</span><br><span class="line">                    (value !&#x3D; null &amp;&amp; value.equals(v)))</span><br><span class="line">                    return true;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/22/%E6%AF%8F%E6%97%A5%E4%B8%89%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="oldnineping">
      <meta itemprop="description" content="技术日记和杂七杂八的dx">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="地球上的小东西">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/22/%E6%AF%8F%E6%97%A5%E4%B8%89%E9%A2%98/" class="post-title-link" itemprop="url">每日三题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-03-22 16:14:39" itemprop="dateCreated datePublished" datetime="2021-03-22T16:14:39+08:00">2021-03-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-25 17:27:32" itemprop="dateModified" datetime="2021-06-25T17:27:32+08:00">2021-06-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="20210322"><a href="#20210322" class="headerlink" title="20210322"></a>20210322</h3><h4 id="回文字符串"><a href="#回文字符串" class="headerlink" title="回文字符串"></a>回文字符串</h4><p>给定一个字符串，请编写一个函数判断该字符串是否回文。如果回文请返回true，否则返回false。</p>
<p><strong>题解：</strong></p>
<p>双指针可解决</p>
<img src="/2021/03/22/%E6%AF%8F%E6%97%A5%E4%B8%89%E9%A2%98/image-20210322161648164.png" alt="image-20210322161648164" style="zoom:50%;">

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">judge</span> <span class="params">(String str)</span> </span>&#123;</span><br><span class="line">       <span class="comment">// write code here</span></span><br><span class="line">       <span class="keyword">if</span>(str == <span class="keyword">null</span> || str == <span class="string">&quot;&quot;</span>)</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">           </span><br><span class="line">       <span class="keyword">int</span> len = str.length();</span><br><span class="line">       <span class="keyword">int</span> l =<span class="number">0</span>, r = len-<span class="number">1</span>;</span><br><span class="line">       <span class="keyword">while</span>(l&lt;r)&#123;</span><br><span class="line">           <span class="keyword">if</span>(str.charAt(l)!=str.charAt(r)) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">           l++;</span><br><span class="line">           r--;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">true</span>;</span><br></pre></td></tr></table></figure>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/03/22/%E6%AF%8F%E6%97%A5%E4%B8%89%E9%A2%98/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/09/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="oldnineping">
      <meta itemprop="description" content="技术日记和杂七杂八的dx">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="地球上的小东西">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/09/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5/" class="post-title-link" itemprop="url">多线程和线程同步</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-03-09 13:52:30" itemprop="dateCreated datePublished" datetime="2021-03-09T13:52:30+08:00">2021-03-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-25 17:27:32" itemprop="dateModified" datetime="2021-06-25T17:27:32+08:00">2021-06-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/%E7%BA%BF%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">线程</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="进程和线程-介绍"><a href="#进程和线程-介绍" class="headerlink" title="进程和线程(介绍)"></a>进程和线程(介绍)</h1><ul>
<li><p>操作系统中运行多个软件。</p>
</li>
<li><p>一个运行中的软件可能包含多个进程。</p>
</li>
<li><p> 一个运行中的进程可能包含多个线程。</p>
</li>
<li><p> 操作系统开辟一段内存/资源给进程。</p>
</li>
</ul>
<h2 id="进程和线程的异同"><a href="#进程和线程的异同" class="headerlink" title="进程和线程的异同"></a>进程和线程的异同</h2><ul>
<li>进程之间的内存不共享，线程程可以共享资源，都可以并行工作。</li>
<li>他们本质上不是一个东西，像是家庭和家庭成员的关系,进程相当于一个运行的程序，线程是一个程序里的并行线路之一。</li>
</ul>
<h2 id="CPU-线程和操作系统线程"><a href="#CPU-线程和操作系统线程" class="headerlink" title="CPU 线程和操作系统线程"></a>CPU 线程和操作系统线程</h2><ol>
<li><p>CPU 线程：</p>
<p>多核 CPU 的每个核各自独立运行，因此每个核一个线程 「四核八线程」:CPU 硬件方在硬件级别对 CPU 进行了一核多线程的 支持(本质上依然是每个核一个线程)</p>
</li>
<li><p>操作系统线程:</p>
<p>操作系统利用时间分片的方式，把 CPU 的运行拆分给多条 运行逻辑，即为操作系统的线程，开发中接触的是操作系统线程。</p>
</li>
</ol>
<p>单核 CPU 也可以运行多线程操作系统 </p>
<h2 id="线程是什么"><a href="#线程是什么" class="headerlink" title="线程是什么:"></a>线程是什么:</h2><p>按代码顺序执行下来，执行完毕就结束的一条线</p>
<h2 id="UI-线程为什么不会结束"><a href="#UI-线程为什么不会结束" class="headerlink" title="UI 线程为什么不会结束?"></a>UI 线程为什么不会结束?</h2><p>因为它在初始化完毕后会执行死循环，循环的内 容是刷新界面。</p>
<p>为什么一直循环却不会卡，就是因为在循环所以程序才没有结束，一次循环就是一次生命周期。</p>
<p>如果在ui线程中写了四循环，那么ui的下一次刷新就永远无法到来，就卡住了。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2021/03/09/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2021/03/07/Koa%E5%85%A5%E9%97%A81-%E7%AE%80%E4%BB%8B%E5%92%8C%E5%8E%9F%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpeg">
      <meta itemprop="name" content="oldnineping">
      <meta itemprop="description" content="技术日记和杂七杂八的dx">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="地球上的小东西">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/03/07/Koa%E5%85%A5%E9%97%A81-%E7%AE%80%E4%BB%8B%E5%92%8C%E5%8E%9F%E7%90%86/" class="post-title-link" itemprop="url">Koa入门</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-03-07 23:04:57" itemprop="dateCreated datePublished" datetime="2021-03-07T23:04:57+08:00">2021-03-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-06-25 17:27:32" itemprop="dateModified" datetime="2021-06-25T17:27:32+08:00">2021-06-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/Node/" itemprop="url" rel="index"><span itemprop="name">Node</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%89%8D%E7%AB%AF/Node/Koa/" itemprop="url" rel="index"><span itemprop="name">Koa</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Koa-简介"><a href="#Koa-简介" class="headerlink" title="Koa 简介"></a>Koa 简介</h1><h2 id="什么是Koa"><a href="#什么是Koa" class="headerlink" title="什么是Koa"></a>什么是Koa</h2><p>Koa是一个新的Web框架，致力于成为web应用和 API 开发领域中的一个更小的、更有表现力的、更健壮的基石。</p>
<p>利用 <strong>asyc 函数</strong> 丢弃回调函数，并增强错误处理。Koa没有任何预置的中间件，可以快速地编写服务端的应用程序。</p>
<h3 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h3><ul>
<li>koa application （应用程序）</li>
<li>Context （上下文） 责任链模式使用中间件响应request</li>
<li>Request （请求）、Response （响应）</li>
</ul>
<img src="/2021/03/07/Koa%E5%85%A5%E9%97%A81-%E7%AE%80%E4%BB%8B%E5%92%8C%E5%8E%9F%E7%90%86/image-20210308084411717.png" alt="image-20210308084411717" style="zoom:50%;">

<h3 id="Hello-Wolrd"><a href="#Hello-Wolrd" class="headerlink" title="Hello Wolrd"></a>Hello Wolrd</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br><span class="line">npm install --save koa</span><br></pre></td></tr></table></figure>
<p>index.js</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const Koa &#x3D; require(&#39;koa&#39;)</span><br><span class="line">const app &#x3D; new Koa()</span><br><span class="line"></span><br><span class="line">app.use(async ctx &#x3D;&gt; &#123; </span><br><span class="line">  ctx.body &#x3D; &#39;Helllo World&#39;</span><br><span class="line">&#125;)</span><br><span class="line">&#x2F;&#x2F;端口号 3000</span><br><span class="line">app.listen(3000)</span><br></pre></td></tr></table></figure>
<p>运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node index.js</span><br></pre></td></tr></table></figure>
<h2 id="Requst-属性、路由基本用法、await-amp-sync核心原理"><a href="#Requst-属性、路由基本用法、await-amp-sync核心原理" class="headerlink" title="Requst 属性、路由基本用法、await &amp; sync核心原理"></a>Requst 属性、路由基本用法、await &amp; sync核心原理</h2><h3 id="ctx-和Request-amp-Response"><a href="#ctx-和Request-amp-Response" class="headerlink" title="ctx 和Request &amp;Response"></a>ctx 和Request &amp;Response</h3><p>ctx对象包括此次请求的host，request ，response等信息。</p>
<p>ctx.request 获取request信息，包括请求方法和内容。</p>
<p>console.log(ctx)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  request: &#123;</span><br><span class="line">    method: &#39;GET&#39;,</span><br><span class="line">    url: &#39;&#x2F;&#39;,</span><br><span class="line">    header: &#123;</span><br><span class="line">      host: &#39;localhost:3000&#39;,</span><br><span class="line">      connection: &#39;keep-alive&#39;,</span><br><span class="line">      &#39;cache-control&#39;: &#39;max-age&#x3D;0&#39;,</span><br><span class="line">      &#39;sec-ch-ua&#39;: &#39;&quot; Not A;Brand&quot;;v&#x3D;&quot;99&quot;, &quot;Chromium&quot;;v&#x3D;&quot;90&quot;, &quot;Google Chrome&quot;;v&#x3D;&quot;90&quot;&#39;,</span><br><span class="line">      &#39;sec-ch-ua-mobile&#39;: &#39;?0&#39;,</span><br><span class="line">      &#39;upgrade-insecure-requests&#39;: &#39;1&#39;,</span><br><span class="line">      &#39;user-agent&#39;: &#39;Mozilla&#x2F;5.0 (Macintosh; Intel Mac OS X 10_14_6) &#39; +</span><br><span class="line">        &#39;AppleWebKit&#x2F;537.36 (KHTML, like Gecko) Chrome&#x2F;90.0.4430.85 &#39; +</span><br><span class="line">        &#39;Safari&#x2F;537.36&#39;,</span><br><span class="line">      accept: &#39;text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,image&#x2F;apng,*&#x2F;*;q&#x3D;0.8,application&#x2F;signed-exchange;v&#x3D;b3;q&#x3D;0.9&#39;,</span><br><span class="line">      &#39;sec-fetch-site&#39;: &#39;none&#39;,</span><br><span class="line">      &#39;sec-fetch-mode&#39;: &#39;navigate&#39;,</span><br><span class="line">      &#39;sec-fetch-user&#39;: &#39;?1&#39;,</span><br><span class="line">      &#39;sec-fetch-dest&#39;: &#39;document&#39;,</span><br><span class="line">      &#39;accept-encoding&#39;: &#39;gzip, deflate, br&#39;,</span><br><span class="line">      &#39;accept-language&#39;: &#39;en-GB,en;q&#x3D;0.9,zh-CN;q&#x3D;0.8,zh;q&#x3D;0.7&#39;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  response: &#123;</span><br><span class="line">    status: 404,</span><br><span class="line">    message: &#39;Not Found&#39;,</span><br><span class="line">    header: [Object: null prototype] &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  app: &#123; subdomainOffset: 2, proxy: false, env: &#39;development&#39; &#125;,</span><br><span class="line">  originalUrl: &#39;&#x2F;&#39;,</span><br><span class="line">  req: &#39;&lt;original node req&gt;&#39;,</span><br><span class="line">  res: &#39;&lt;original node res&gt;&#39;,</span><br><span class="line">  socket: &#39;&lt;original node socket&gt;&#39;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="router让应用拥有api-url-的地址"><a href="#router让应用拥有api-url-的地址" class="headerlink" title="router让应用拥有api/url 的地址"></a>router让应用拥有api/url 的地址</h3><p>npmjs.com 下载koa-router</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -s koa-router </span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入router</span></span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">&#x27;koa-router&#x27;</span>)</span><br><span class="line"><span class="comment">// router类实例</span></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> Router()</span><br><span class="line"><span class="comment">//get请求，url 为空(根目录)</span></span><br><span class="line">router.get(<span class="string">&#x27;/&#x27;</span>,<span class="function"><span class="params">ctx</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(ctx)</span><br><span class="line">  <span class="built_in">console</span>.log(ctx.request)</span><br><span class="line">  ctx.body = <span class="string">&#x27;Hello World!!&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//get请求，url路径 为/api</span></span><br><span class="line">router.get(<span class="string">&#x27;/api&#x27;</span>,<span class="function"><span class="params">ctx</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(ctx)</span><br><span class="line">  <span class="built_in">console</span>.log(ctx.request)</span><br><span class="line">  ctx.body = <span class="string">&#x27;Hello Api!!&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//将所有定义在router类傻姑娘的方法应用到app上去处理</span></span><br><span class="line">app.use(router.routes())<span class="comment">//应用router对象上的所有route</span></span><br><span class="line">  .use(router.allowedMethods())<span class="comment">// 拦截器，拦截应用中没有的请求，直接返回4xx或者5xx</span></span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>


<h3 id="async-await"><a href="#async-await" class="headerlink" title="async/await"></a>async/await</h3><h4 id="Koa核心原理：洋葱模型"><a href="#Koa核心原理：洋葱模型" class="headerlink" title="Koa核心原理：洋葱模型"></a>Koa核心原理：洋葱模型</h4><img src="/2021/03/07/Koa%E5%85%A5%E9%97%A81-%E7%AE%80%E4%BB%8B%E5%92%8C%E5%8E%9F%E7%90%86/image-20210430151809727.png" alt="image-20210430151809727" style="zoom:50%;">

<p>一个Request进来，会依次执行中间件，</p>
<ul>
<li>执行顺序：顺序执行</li>
<li>回调的舒徐：反向执行</li>
<li>先进后出</li>
</ul>
<p>官方推荐对数据的操作全部使用中间件完成。</p>
<p>参考文档：</p>
<p>app.use(function)</p>
<p>将给定的中间件方法添加到此应用程序。<code>app.use()</code> 返回 <code>this</code>, 因此可以链式表达.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.use(someMiddleware)</span><br><span class="line">app.use(someOtherMiddleware)</span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>
<p>它等同于</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.use(someMiddleware)</span><br><span class="line">  .use(someOtherMiddleware)</span><br><span class="line">  .listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>
<p>执行过程：先入后出</p>
<p>先入：request 进入时：</p>
<ol>
<li>request进入后按顺序执行next（）方法之前的代码 顺序是middleware1，2，3，</li>
<li>middleware3 ，没有next()方法，视为终止传递，开始回传</li>
</ol>
<p>后出：</p>
<ol>
<li><p>顺序将会反过来：2，1，因为3 中next() 后面的代码,(因为middleware3没有next方法，所以回传后也没有可以执行的内容)</p>
</li>
<li><p>middleware3加入next方法则执行next（）后面代码的顺序为：middleware3，middleware2，middleware1，因为request进入时middleware3 已经没有可以向下传递的中间件了，还是从3开始回传</p>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> Koa()</span><br><span class="line"></span><br><span class="line"><span class="comment">//中间件 0</span></span><br><span class="line"><span class="keyword">const</span> middleware3 = <span class="function"><span class="keyword">function</span> <span class="title">async</span>(<span class="params">ctx,next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;this is a middleware3!&#x27;</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(ctx.request.path)</span><br><span class="line">  <span class="comment">//不写next（）方法， 视为终止传递，开始回传</span></span><br><span class="line">  <span class="comment">// next()</span></span><br><span class="line">  <span class="comment">// console.log(&#x27;this is a middleware3! End&#x27;)</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//中间件1</span></span><br><span class="line"><span class="keyword">const</span> middleware1 = <span class="function"><span class="keyword">function</span> <span class="title">async</span>(<span class="params">ctx,next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;this is a middleware1!&#x27;</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(ctx.request.path)</span><br><span class="line">  <span class="comment">//写了next方法，会传递给下一个中间件</span></span><br><span class="line">  next()</span><br><span class="line">  <span class="comment">//按照app.use方法插入中间件的顺序（先进后出）middleware2回传后执行，</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;this is a middleware1! End&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//中间件2</span></span><br><span class="line"><span class="keyword">const</span> middleware2 = <span class="function"><span class="keyword">function</span> <span class="title">async</span>(<span class="params">ctx,next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;this is a middleware2&#x27;</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(ctx.request.path)</span><br><span class="line">  <span class="comment">//写了next方法，会传递给下一个中间件</span></span><br><span class="line">  next()</span><br><span class="line">  <span class="comment">//middleware没有next方法，so按照app.use方法插入中间件的顺序，middleware2先执行回传的方法</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;this is a middleware2! End&#x27;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.use(middleware1)</span><br><span class="line">app.use(middleware2)</span><br><span class="line">app.use(middleware3)</span><br><span class="line">app.listen(<span class="number">3000</span>)</span><br></pre></td></tr></table></figure>
<p>terminal输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">this is a middleware1!</span><br><span class="line">/</span><br><span class="line">this is a middleware2</span><br><span class="line">/</span><br><span class="line">this is a middleware3!</span><br><span class="line">/</span><br><span class="line">this is a middleware3! End</span><br><span class="line">this is a middleware2! End</span><br><span class="line">this is a middleware1! End</span><br></pre></td></tr></table></figure>
<h4 id="Koa中的async、await"><a href="#Koa中的async、await" class="headerlink" title="Koa中的async、await"></a>Koa中的async、await</h4><p><strong>小tip：Await必须 async包裹，async里面可以没有await</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;await async eg</span><br><span class="line">router.get(&#39;&#x2F;async&#39;,async (ctx) &#x3D;&gt; &#123;</span><br><span class="line">  let result &#x3D; await new Promise((resolve) &#x3D;&gt; &#123;</span><br><span class="line">    setTimeout(function () &#123;</span><br><span class="line">      resolve(&#39;hello world 2s later&#39;)</span><br><span class="line">    &#125;,2000)</span><br><span class="line">  &#125;)</span><br><span class="line">  ctx.body &#x3D; result</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h3 id="Koa特点"><a href="#Koa特点" class="headerlink" title="Koa特点"></a>Koa特点</h3><ul>
<li>简洁</li>
<li>await /async</li>
<li>丰富的中间件</li>
</ul>
<h1 id="进阶篇"><a href="#进阶篇" class="headerlink" title="进阶篇"></a>进阶篇</h1><h2 id="Koa开发RESTful接口"><a href="#Koa开发RESTful接口" class="headerlink" title="Koa开发RESTful接口"></a>Koa开发RESTful接口</h2><h3 id="Koa中间件"><a href="#Koa中间件" class="headerlink" title="Koa中间件"></a>Koa中间件</h3><ul>
<li>路由： <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/koa-router">koa-router</a></li>
<li>协议解析： <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/koa-body">koa-body</a></li>
<li>跨域处理：<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/@koa/cors">@koa/cors</a></li>
</ul>
<p>中间件查看：<a target="_blank" rel="noopener" href="https://www.npmjs.com/">https://www.npmjs.com/</a></p>
<p>一次性安装以上中间件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -S koa-router koa-body @koa/cors</span><br></pre></td></tr></table></figure>
<h4 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h4><p>Eg:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 引入router</span></span><br><span class="line"><span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">&#x27;koa-router&#x27;</span>)</span><br><span class="line"><span class="comment">//引入 跨域处理中间件</span></span><br><span class="line"><span class="keyword">const</span> cors = <span class="built_in">require</span>(<span class="string">&#x27;@koa/cors&#x27;</span>)</span><br><span class="line"><span class="comment">//引入 koa-body，协议解析中间件</span></span><br><span class="line"><span class="keyword">const</span> koaBody = <span class="built_in">require</span>(<span class="string">&#x27;koa-body&#x27;</span>)</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">//restful 接口</span></span><br><span class="line">router.post(<span class="string">&#x27;/post&#x27;</span>,<span class="keyword">async</span> (ctx) =&gt; &#123;</span><br><span class="line">  <span class="comment">// es6 写法，相当于body请求体里的内容全部赋值给body对象</span></span><br><span class="line">    <span class="keyword">let</span> &#123;body&#125; =ctx.request</span><br><span class="line">    <span class="built_in">console</span>.log(body)</span><br><span class="line">    <span class="built_in">console</span>.log(ctx.request)</span><br><span class="line">    ctx.body = &#123;</span><br><span class="line">      <span class="comment">// 扩展运算符，相当于把body中的内容扩展开后返回回去,如果去掉的话，传json串的时候返回的最外层会带上body&#123;&#125;</span></span><br><span class="line">      ...body</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//中间件是有执行顺序的，先use koabody解析，再use @koa/cors 处理跨域</span></span><br><span class="line">app.use(koaBody())</span><br><span class="line">app.use(cors())</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h4 id="路由前缀设置"><a href="#路由前缀设置" class="headerlink" title="路由前缀设置"></a>路由前缀设置</h4><p>也就是router的prefix</p>
<p>Eg：在所有router前面加上</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 增加前缀 api 加上它，所有请求都要在前面加上前缀/api</span></span><br><span class="line">router.prefix(<span class="string">&#x27;/api&#x27;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="获取GET请求中的params"><a href="#获取GET请求中的params" class="headerlink" title="获取GET请求中的params"></a>获取GET请求中的params</h4><p>请求参数：<code>http://localhost:3000/api/api?name=zz1&amp;age=28</code></p>
<p>Eg</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/api&#x27;</span>,<span class="function"><span class="params">ctx</span> =&gt;</span> &#123;</span><br><span class="line">   <span class="keyword">const</span> params = ctx.request.query</span><br><span class="line">   <span class="comment">//parms = &#123; name: &#x27;zz1&#x27;, age: &#x27;28&#x27; &#125;</span></span><br><span class="line">   <span class="built_in">console</span>.log(params)</span><br><span class="line">   <span class="built_in">console</span>.log(params.name,params.age)</span><br><span class="line">  <span class="comment">// console.log(ctx)</span></span><br><span class="line">  <span class="comment">// console.log(ctx.request)</span></span><br><span class="line">  ctx.body = &#123;</span><br><span class="line">    name : params.name,</span><br><span class="line">    age  : params.age</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Terminal 输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Object: null prototype] &#123; name: &#39;zz1&#39;, age: &#39;28&#39; &#125;</span><br><span class="line">zz1</span><br></pre></td></tr></table></figure>
<p>请求后返回的body为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;name&quot;: &quot;zz1&quot;,</span><br><span class="line">    &quot;age&quot;: &quot;28&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因为是Json类型的，默认的返回不够美观我们可以使用 中间件<a target="_blank" rel="noopener" href="https://www.npmjs.com/package/koa-json">koa-json</a></p>
<p>安装：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -S koa-json</span><br></pre></td></tr></table></figure>
<p>简单Eg：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> json = <span class="built_in">require</span>(<span class="string">&#x27;koa-json&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> Koa = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> Koa();</span><br><span class="line"> </span><br><span class="line">app.use(json());</span><br></pre></td></tr></table></figure>
<p>只在传参pretty=pretty时开启Json解析</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(json(&#123; <span class="attr">pretty</span>: <span class="literal">false</span>, <span class="attr">param</span>: <span class="string">&#x27;pretty&#x27;</span> &#125;));</span><br></pre></td></tr></table></figure>
<p>Eg：浏览器访问：<a target="_blank" rel="noopener" href="http://localhost:3000/api/api?name=zz1&amp;age=28&amp;pretty=pretty%E6%AD%A4%E6%97%B6body%E4%B8%AD%E7%9A%84json%E4%B8%B2%E5%B7%B2%E8%A7%A3%E6%9E%90%EF%BC%8C%E4%B8%8D%E4%BC%A0pretty%E5%8F%82%E6%95%B0%E5%88%99%E4%B8%8D%E8%A7%A3%E6%9E%90Json">http://localhost:3000/api/api?name=zz1&amp;age=28&amp;pretty=pretty此时body中的json串已解析，不传pretty参数则不解析Json</a></p>
<p>也可以在浏览器复制返回的Json在console输入JS代码格式化Json</p>
<p><img src="/2021/03/07/Koa%E5%85%A5%E9%97%A81-%E7%AE%80%E4%BB%8B%E5%92%8C%E5%8E%9F%E7%90%86/image-20210430180620550.png" alt="image-20210430180620550"></p>
<h2 id="webpack-升级v5"><a href="#webpack-升级v5" class="headerlink" title="webpack 升级v5"></a>webpack 升级v5</h2><p>webpack核心概念</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://webpack.docschina.org/concepts/#entry">入口(entry)</a></li>
<li><a target="_blank" rel="noopener" href="https://webpack.docschina.org/concepts/#output">输出(output)</a></li>
<li><a target="_blank" rel="noopener" href="https://webpack.docschina.org/concepts/#loaders">loader</a></li>
<li><a target="_blank" rel="noopener" href="https://webpack.docschina.org/concepts/#plugins">插件(plugin)</a></li>
<li><a target="_blank" rel="noopener" href="https://webpack.docschina.org/concepts/#mode">模式(mode)</a></li>
</ul>
<p>webpack v5版本会对以上代码产生影响，解决方案：</p>
<ol>
<li>使用webpack v4 webpackcli v3<code>cnpm i -D webpack@4 webpack-cli@3</code></li>
<li>使用webpack v5 webpackcli v4则采用如下配置</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> nodeExternals = <span class="built_in">require</span>(<span class="string">&#x27;webpack-node-externals&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> webpackconfig = &#123;</span><br><span class="line">  mode: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">  entry: &#123;</span><br><span class="line">    server: path.join(__dirname, <span class="string">&#x27;src/index.js&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  output: &#123;</span><br><span class="line">    filename: <span class="string">&#x27;[name].bundle.js&#x27;</span>,</span><br><span class="line">    path: path.join(__dirname, <span class="string">&#x27;./dist&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  devtool: <span class="string">&#x27;eval-cheap-source-map&#x27;</span></span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.(js|jsx)$/</span>,</span><br><span class="line">        use: &#123;</span><br><span class="line">          loader: <span class="string">&#x27;babel-loader&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        exclude: [path.join(__dirname, <span class="string">&#x27;node_modules&#x27;</span>)]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  plugins: [</span><br><span class="line">    <span class="keyword">new</span> CleanWebpackPlugin()</span><br><span class="line">  ],</span><br><span class="line">  externals: [nodeExternals()],</span><br><span class="line">  target: <span class="string">&#x27;node&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = webpackconfig</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>v5 说明：<a target="_blank" rel="noopener" href="https://webpack.docschina.org/blog/2020-10-10-webpack-5-release/">https://webpack.docschina.org/blog/2020-10-10-webpack-5-release/</a></p>
<p>v4迁移v5指南：<a target="_blank" rel="noopener" href="https://webpack.docschina.org/migrate/5/">https://webpack.docschina.org/migrate/5/</a></p>
<h2 id="工作目录、合并路由、静态资源服务"><a href="#工作目录、合并路由、静态资源服务" class="headerlink" title="工作目录、合并路由、静态资源服务"></a>工作目录、合并路由、静态资源服务</h2><h3 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h3><p><a target="_blank" rel="noopener" href="https://gitee.com/laonaiping/koa-pro">https://gitee.com/laonaiping/koa-pro</a></p>
<p>工作目录：</p>
<ol>
<li>按照功能模块进行区分</li>
<li>路由压缩(只要使用一次use即可不用重复调用)： npm install koa-combine-routers –save</li>
<li>静态资源： koa-static</li>
</ol>
<p>初始化项目目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">初始化一个项目 koa-pro</span><br><span class="line">npm init -y</span><br><span class="line">npm install koa koa-router koa-body @koa/cors koa-json koa-combine-routers koa-helment koa-static --save</span><br><span class="line">//koa-pro 下新建 public目录放静态资源文件</span><br><span class="line">mkdir public</span><br><span class="line">//koa-pro 下新建 src目录</span><br><span class="line">mkdir src</span><br><span class="line">//src  下新建 index.js 作为入口文件</span><br><span class="line">touch src/index.js </span><br><span class="line">//src 下新建api文件夹 进行路由业务处理</span><br><span class="line">mkdir src/api </span><br><span class="line">//routes 下新建routes.js  合并routes</span><br><span class="line">mkdir src/routes</span><br></pre></td></tr></table></figure>
<p>安全头</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">koa-helmet 安全头</span><br><span class="line"><span class="keyword">const</span> helmet = <span class="built_in">require</span>(<span class="string">&#x27;koa-helmet&#x27;</span>)</span><br><span class="line">app.use(helmet())</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>静态资源压缩</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">koa-<span class="keyword">static</span> 静态文件引入</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">static</span> = <span class="built_in">require</span>(<span class="string">&#x27;koa-static&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">static</span>(path.join(__dirname, <span class="string">&#x27;../public&#x27;</span>)))       </span><br></pre></td></tr></table></figure>


<h2 id="Koa开发热加载、ES6语法支持"><a href="#Koa开发热加载、ES6语法支持" class="headerlink" title="Koa开发热加载、ES6语法支持"></a>Koa开发热加载、ES6语法支持</h2><h4 id="热加载-nodemon"><a href="#热加载-nodemon" class="headerlink" title="热加载 nodemon"></a>热加载 nodemon</h4><p>js发生变化时直接启动，起到一个热加载到效果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">安装到测试环境</span><br><span class="line">npm install -D nodemon</span><br><span class="line">查看版本</span><br><span class="line">npx nodemon --version</span><br><span class="line">启动index.js</span><br><span class="line">npx nodemon src/index.js</span><br><span class="line">修改一下配置文件的npm 脚本</span><br><span class="line">package.json &gt;&gt;</span><br><span class="line"><span class="string">&quot;script&quot;</span>: &#123;</span><br><span class="line">   <span class="string">&quot;start&quot;</span>: <span class="string">&quot;nodemon src/app.js&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">这样我们每次调试只要使用 `npm run start` 就可以使用热加载功能啦</span><br></pre></td></tr></table></figure>
<h4 id="ES6-语法支持"><a href="#ES6-语法支持" class="headerlink" title="ES6 语法支持"></a>ES6 语法支持</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">npm install -D webpack webpack-cli </span><br><span class="line">npm install -D clean-webpack-plugin webpack-node-externals @babel/core @babel/node @babel/preset-env babel-loader cross-env @babel/node </span><br><span class="line">// 创建配置文件</span><br><span class="line">touch webpack.config.js</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ol>
<li>clean-webpack-plugin: 清理dist目录下的文件</li>
<li>webpack-node-externals 主要是对node_modules下的文件做一个排除处理</li>
<li>@babel/core @babel/node 调试需要</li>
<li>@babel/preset-env 对特性做支持</li>
<li>babel-loader 在webpack中使用到的loader</li>
<li>cross-env 设置环境变量 </li>
</ol>
<p>下配置不适用最新版本webpack的需要降级：使用webpack v4 webpackcli v3<code>cnpm i -D webpack@4 webpack-cli@3</code></p>
<p>webpack.config.js:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> nodeExternals = <span class="built_in">require</span>(<span class="string">&#x27;webpack-node-externals&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123;CleanWebpackPlugin&#125; = <span class="built_in">require</span>(<span class="string">&#x27;clean-webpack-plugin&#x27;</span>)</span><br><span class="line">webpackconfig = &#123;</span><br><span class="line">	target: <span class="string">&quot;node&quot;</span>,</span><br><span class="line">	mode: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">	entry: &#123;</span><br><span class="line">		server: path.join(__dirname, <span class="string">&#x27;./src/index.js&#x27;</span>)</span><br><span class="line">	&#125;,</span><br><span class="line">	output: &#123;</span><br><span class="line">		filename: <span class="string">&#x27;[name].bundle.js&#x27;</span>,</span><br><span class="line">		path: path.join(__dirname, <span class="string">&#x27;./dist&#x27;</span>)</span><br><span class="line">	&#125;,</span><br><span class="line">	devtool:<span class="string">&#x27;eval-source-map&#x27;</span>,</span><br><span class="line">	<span class="built_in">module</span>: &#123;</span><br><span class="line">		rules: [</span><br><span class="line">			&#123;</span><br><span class="line">				test: <span class="regexp">/\.(js|jsx)$/</span>,</span><br><span class="line">				use: &#123;</span><br><span class="line">					loader: <span class="string">&#x27;babel-loader&#x27;</span></span><br><span class="line">				&#125;,</span><br><span class="line">				exclude: [path.join(__dirname, <span class="string">&#x27;/node_modules&#x27;</span>)]</span><br><span class="line">			&#125;</span><br><span class="line">		]</span><br><span class="line">	&#125;,</span><br><span class="line">	externals: [nodeExternals()],</span><br><span class="line">	plugins: [</span><br><span class="line">		<span class="keyword">new</span> CleanWebpackPlugin()</span><br><span class="line">	],</span><br><span class="line">	node: &#123;</span><br><span class="line">		<span class="built_in">console</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="built_in">global</span>: <span class="literal">true</span>,</span><br><span class="line">		process: <span class="literal">true</span>,</span><br><span class="line">		Buffer: <span class="literal">true</span>,</span><br><span class="line">		__filename: <span class="literal">true</span>,</span><br><span class="line">		__dirname: <span class="literal">true</span>,</span><br><span class="line">		setImmediate: <span class="literal">true</span>,</span><br><span class="line">		path: <span class="literal">true</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(webpackconfig)</span><br><span class="line"><span class="built_in">module</span>.exports = webpackconfig</span><br></pre></td></tr></table></figure>
<p>.babelrc</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;presets&quot;: [</span><br><span class="line">		[</span><br><span class="line">			&quot;@babel&#x2F;preset-env&quot;,</span><br><span class="line">			&#123;</span><br><span class="line">				&quot;targets&quot;: &#123;</span><br><span class="line">					&quot;node&quot;: &quot;current&quot;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		]</span><br><span class="line">	]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>npx webpack (打包指令)运行成功之后，index引用改为ES6语法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> koa <span class="keyword">from</span> <span class="string">&#x27;koa&#x27;</span></span><br><span class="line"><span class="keyword">import</span> path <span class="keyword">from</span> <span class="string">&#x27;path&#x27;</span></span><br><span class="line"><span class="keyword">import</span> helmet <span class="keyword">from</span> <span class="string">&#x27;koa-helmet&#x27;</span></span><br><span class="line"><span class="keyword">import</span> statics <span class="keyword">from</span> <span class="string">&#x27;koa-static&#x27;</span></span><br><span class="line"><span class="keyword">import</span> router <span class="keyword">from</span> <span class="string">&#x27;./routes/routes&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> koa()</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> npx nodemon --exec babel-node src/index.js</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">除了npx运行方式，可以在package,json中添加脚本运行</span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//&quot;start&quot;: &quot;nodemon src/index.js&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;start&quot;</span>: <span class="string">&quot;nodemon --exec babel-node src/index.js&quot;</span></span><br><span class="line"></span><br><span class="line">  &#125;,</span><br><span class="line">      </span><br></pre></td></tr></table></figure>


<h1 id="调试篇"><a href="#调试篇" class="headerlink" title="调试篇"></a>调试篇</h1><h2 id="调试webpack、配置vscode调试"><a href="#调试webpack、配置vscode调试" class="headerlink" title="调试webpack、配置vscode调试"></a>调试webpack、配置vscode调试</h2><p>如何查看webpack配置是否正确</p>
<h4 id="webpack-config-js"><a href="#webpack-config-js" class="headerlink" title="webpack.config.js:"></a>webpack.config.js:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(webpackconfig)</span><br></pre></td></tr></table></figure>
<h4 id="使用node-调试"><a href="#使用node-调试" class="headerlink" title="使用node 调试"></a>使用node 调试</h4><p> 监视调试的过程     </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npx node --inspect-brk ./node_modules/.bin/webpack  --inline --progress </span><br><span class="line">npx node --inspect-brk ./node_modules/webpack/bin/webpack --inline --progress  </span><br></pre></td></tr></table></figure>
<p>第一种苹果电脑适用  第二种windows电话适用</p>
<p>执行之后，谷歌浏览器打开  chrome://inspect/#devices</p>
<p>点击inspect  ,打开一个webpack的调试窗口  </p>
<p>在const webpackconfig  前添加debugger断点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">module.exports &#x3D; webpackconfig前添加console.log(webpackconfig)</span><br><span class="line">debuggerconsole.log(webpackconfig)</span><br></pre></td></tr></table></figure>
<p>把调试语句添加到package.json的scripts里</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span>: &#123;  </span><br><span class="line"><span class="string">&quot;start&quot;</span>: <span class="string">&quot;nodemon --exec babel-node src/index.js&quot;</span>,   </span><br><span class="line"><span class="string">&quot;webpack:debug&quot;</span>: <span class="string">&quot;node --inspect-brk ./node_modules/webpack/bin/webpack --inline --progress&quot;</span>  &#125;,</span><br><span class="line">之后可以使用 npm run webpack:debug</span><br></pre></td></tr></table></figure>
<img src="/2021/03/07/Koa%E5%85%A5%E9%97%A81-%E7%AE%80%E4%BB%8B%E5%92%8C%E5%8E%9F%E7%90%86/image-20210527184528651.png" alt="image-20210527184528651" style="zoom:50%;">

<p>点击运行开始debug</p>
<img src="/2021/03/07/Koa%E5%85%A5%E9%97%A81-%E7%AE%80%E4%BB%8B%E5%92%8C%E5%8E%9F%E7%90%86/image-20210527184556060.png" alt="image-20210527184556060" style="zoom:50%;">

<h3 id="VsCode-调试"><a href="#VsCode-调试" class="headerlink" title="VsCode 调试"></a>VsCode 调试</h3><ol>
<li><p>点小虫子之后选择调试环境为NodeJs</p>
<p><img src="/2021/03/07/Koa%E5%85%A5%E9%97%A81-%E7%AE%80%E4%BB%8B%E5%92%8C%E5%8E%9F%E7%90%86/image-20210527185236825.png" alt="image-20210527185236825"></p>
</li>
<li><p>修改调试配置文件 .vscode/launch.json</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="comment">// 使用 IntelliSense 了解相关属性。 </span></span><br><span class="line">  <span class="comment">// 悬停以查看现有属性的描述。</span></span><br><span class="line">  <span class="comment">// 欲了解更多信息，请访问: https://go.microsoft.com/fwlink/?linkid=830387</span></span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;0.2.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;configurations&quot;</span>: [</span><br><span class="line">    </span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;pwa-node&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;request&quot;</span>: <span class="string">&quot;launch&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;Launch Program&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;skipFiles&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;&lt;node_internals&gt;/**&quot;</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;program&quot;</span>: <span class="string">&quot;$&#123;file&#125;&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;runtimeExecutable&quot;</span>: <span class="string">&quot;$&#123;workspaceFolder&#125;/node_modules/.bin/nodemon&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;program&quot;</span>: <span class="string">&quot;$&#123;workspaceFolder&#125;/src/index.js&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;runtimeArgs&quot;</span>: [<span class="string">&quot;--exec&quot;</span>, <span class="string">&quot;babel-node&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
<li><p>给要调试的内容打断点开启调试</p>
 <img src="/2021/03/07/Koa%E5%85%A5%E9%97%A81-%E7%AE%80%E4%BB%8B%E5%92%8C%E5%8E%9F%E7%90%86/image-20210527194728471.png" alt="image-20210527194728471" style="zoom: 67%;">
</li>
<li><p>在监视里加上想监视的变量名<br><img src="/2021/03/07/Koa%E5%85%A5%E9%97%A81-%E7%AE%80%E4%BB%8B%E5%92%8C%E5%8E%9F%E7%90%86/image-20210527194542709.png" alt="image-20210527194542709"></p>
</li>
</ol>
<p>#实战篇</p>
<h2 id="优化webpack配置、npm构建脚本"><a href="#优化webpack配置、npm构建脚本" class="headerlink" title="优化webpack配置、npm构建脚本"></a>优化webpack配置、npm构建脚本</h2><h4 id="npm构建脚本"><a href="#npm构建脚本" class="headerlink" title="npm构建脚本"></a>npm构建脚本</h4><ul>
<li>检查npm依赖包是否有需要更新的</li>
</ul>
<p>全局安装 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g npm-check-updates</span><br></pre></td></tr></table></figure>
<p>查看可以更新的依赖包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ncu</span><br></pre></td></tr></table></figure>
<p>更新package.json</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ncu -u</span><br></pre></td></tr></table></figure>
<p>删除node_modules文件夹，重新 npm install</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm -rf node_modules</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure>


<h4 id="koa-compose-整合中间件，避免了重复的use-中间件"><a href="#koa-compose-整合中间件，避免了重复的use-中间件" class="headerlink" title="koa-compose 整合中间件，避免了重复的use 中间件"></a>koa-compose 整合中间件，避免了重复的use 中间件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install koa-compose -S</span><br></pre></td></tr></table></figure>
<h4 id="优化webpack的配置"><a href="#优化webpack的配置" class="headerlink" title="优化webpack的配置"></a>优化webpack的配置</h4><ul>
<li><p>webpack-merge 合并webpack配置</p>
</li>
<li><p>terser-webpack-plugin 压缩js代码， webpack5及以上版本不需要安装</p>
</li>
<li><p>推荐配置</p>
</li>
</ul>
<h5 id="多套webpack-配置-（开发，打包，基本）"><a href="#多套webpack-配置-（开发，打包，基本）" class="headerlink" title="多套webpack 配置 （开发，打包，基本）"></a>多套webpack 配置 （开发，打包，基本）</h5><p>通过env处理多套环境的webpack配置。<code>webpack.config.prod.js</code>,<code>webpack.config.dev.js</code>,<code>webpack.config.base.js</code></p>
<p>webpack.config.base 基本配置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">		<span class="keyword">new</span> CleanWebpackPlugin(),</span><br><span class="line">		<span class="keyword">new</span> webpack.EnvironmentPlugin([<span class="string">&#x27;NODE_ENV&#x27;</span>])</span><br><span class="line">	],</span><br></pre></td></tr></table></figure>
<p>EnvironmentPlugin允许我们配置一个常量在打包的时候进行使用。这个常量除了可以区别我们的webpack配置，还可以区分打包时的端口号，打包时的url。</p>
<h5 id="webpack-merge-合并webpack配置"><a href="#webpack-merge-合并webpack配置" class="headerlink" title="webpack-merge 合并webpack配置"></a>webpack-merge 合并webpack配置</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i webpack-merge -D</span><br></pre></td></tr></table></figure>
<p>webpack.config.dev.js 开发配置</p>
<h5 id="terser-webpack-plugin-压缩js代码，-webpack5及以上版本不需要安装"><a href="#terser-webpack-plugin-压缩js代码，-webpack5及以上版本不需要安装" class="headerlink" title="terser-webpack-plugin 压缩js代码， webpack5及以上版本不需要安装"></a>terser-webpack-plugin 压缩js代码， webpack5及以上版本不需要安装</h5><p><a target="_blank" rel="noopener" href="https://v4.webpack.docschina.org/plugins/terser-webpack-plugin/">https://v4.webpack.docschina.org/plugins/terser-webpack-plugin/</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i terser-webpack-plugin -D</span><br></pre></td></tr></table></figure>




<h2 id="Koa应用打包优化"><a href="#Koa应用打包优化" class="headerlink" title="Koa应用打包优化"></a>Koa应用打包优化</h2><h4 id="打包资源压缩，避免重复依赖"><a href="#打包资源压缩，避免重复依赖" class="headerlink" title="打包资源压缩，避免重复依赖"></a>打包资源压缩，避免重复依赖</h4><p>SplitChunksPlugin</p>
<p><a target="_blank" rel="noopener" href="https://v4.webpack.docschina.org/plugins/split-chunks-plugin/">https://v4.webpack.docschina.org/plugins/split-chunks-plugin/</a></p>
<p>配置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//打包资源压缩，避免重复依赖 SplitChunksPlugin</span></span><br><span class="line">splitChunks: &#123;</span><br><span class="line">  cacheGroups: &#123;</span><br><span class="line">    commons: &#123;</span><br><span class="line">      name: <span class="string">&#x27;commons&#x27;</span>,</span><br><span class="line">      chunks: <span class="string">&#x27;initial&#x27;</span>,</span><br><span class="line">      minChunks: <span class="number">3</span>,</span><br><span class="line">      enforce: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>执行脚本</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;build&quot;: &quot;cross-env NODE_ENV=production webpack --config config/webpack.config.prod.js&quot;,</span><br><span class="line">&quot;dev&quot;: &quot;cross-env NODE_ENV=dev nodemon --exec babel-node --inspect ./src/index.js&quot;</span><br></pre></td></tr></table></figure>
<h4 id="Clean-脚本"><a href="#Clean-脚本" class="headerlink" title="Clean 脚本"></a>Clean 脚本</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm i -D rimraf</span><br><span class="line">//package.json scripts增加clean操作</span><br><span class="line"><span class="string">&quot;clean&quot;</span>: <span class="string">&quot;rimraf dist&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="Koa-compress"><a href="#Koa-compress" class="headerlink" title="Koa-compress"></a>Koa-compress</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install koa-compress</span><br><span class="line">koa-compress压缩koa的中间件，基本使用方法：</span><br><span class="line">app.use(compress());       </span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="oldnineping"
      src="/images/avatar.jpeg">
  <p class="site-author-name" itemprop="name">oldnineping</p>
  <div class="site-description" itemprop="description">技术日记和杂七杂八的dx</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">28</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">30</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">29</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">oldnineping</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  













<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

</body>
</html>
